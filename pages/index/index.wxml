
<view class="container">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="bg-decoration">
    <view class="bg-circle bg-circle-1"></view>
    <view class="bg-circle bg-circle-2"></view>
    <view class="bg-circle bg-circle-3"></view>
    <view class="bg-circle bg-circle-4"></view>
    <view class="bg-circle bg-circle-5"></view>
  </view>

  <!-- é¡¶éƒ¨çŠ¶æ€æ  - ä¼˜åŒ–å¸ƒå±€ -->
  <view class="status-bar">
    <view class="status-left">
      <view class="time">{{currentTime}}</view>
      <view class="date">{{currentDate}}</view>
    </view>
    <view class="status-right">
      <view class="weather" bindtap="goToWeather">
        <!-- ä½¿ç”¨æ›´ç°ä»£çš„å›¾æ ‡å­—ç¬¦ -->
        <text class="weather-icon">â˜€</text>
        <text class="weather-temp">{{weather.temperature}}Â°C</text>
      </view>
      <view class="notification" bindtap="goToAlerts">
        <!-- ä½¿ç”¨æ›´ç®€æ´çš„é“ƒé“›å›¾æ ‡ -->
        <text class="notification-icon">ğŸ””</text>
        <view class="notification-badge" wx:if="{{alertCount > 0}}">{{alertCount}}</view>
      </view>
    </view>
  </view>

  <!-- ä¸»æ ‡é¢˜ - ä¼˜åŒ–è®¾è®¡ -->
  <view class="main-title">
    <view class="title-section">
      <text class="title-text">é™†åšèƒ½æ•ˆäº‘</text>
      <text class="title-subtitle">æ™ºæ…§èƒ½æºç®¡ç†å¹³å°</text>
    </view>
    <view class="title-actions">
      <view class="refresh-btn {{isRefreshing ? 'refreshing' : ''}}" bindtap="refreshData">
        <!-- ä½¿ç”¨æ›´ç°ä»£çš„åˆ·æ–°å›¾æ ‡ -->
        <text class="refresh-icon">â†»</text>
      </view>
    </view>
  </view>

  <!-- æ€»èƒ½è€—æ¦‚è§ˆå¡ç‰‡ - ä¼˜åŒ–è®¾è®¡ -->
  <view class="energy-overview glass-card">
    <view class="overview-header">
      <text class="overview-title">ä»Šæ—¥èƒ½è€—æ€»è§ˆ</text>
      <text class="overview-subtitle">ç´¯è®¡æ¶ˆè€—æ•°æ®</text>
    </view>
    <view class="overview-content" wx:if="{{!loading && overview.totalEnergy}}">
      
      <!-- èƒ½è€—åˆ†ç±»åˆ—è¡¨å¸ƒå±€ -->
      <view class="energy-breakdown-list">
        <!-- ç”¨ç”µé‡ç´¯è®¡ -->
        <view class="data-card-list glass-card energy-card-electricity" wx:if="{{overview.electricity}}">
          <view class="data-card-list-content">
            <view class="data-icon electricity-icon">
              <image src="../../assets/icons/power.svg" class="icon-svg" mode="aspectFit"></image>
            </view>
            <view class="data-info-list">
              <view class="data-info-row">
                <text class="data-title">ç”¨ç”µé‡</text>
                <view class="data-value-container">
                  <text class="data-value">{{overview.electricity.value}}</text>
                  <text class="data-unit">{{overview.electricity.unit}}</text>
                </view>
              </view>
            </view>
            <view class="data-trend {{overview.electricity.trend >= 0 ? 'up' : 'down'}}">
              <text class="trend-arrow">{{overview.electricity.trend >= 0 ? 'â†—' : 'â†˜'}}</text>
              <text class="trend-value">{{overview.electricity.trend}}%</text>
            </view>
          </view>
        </view>
        
        <!-- ç”¨æ°´é‡ç´¯è®¡ -->
        <view class="data-card-list glass-card energy-card-water" wx:if="{{overview.water}}">
          <view class="data-card-list-content">
            <view class="data-icon water-icon">
              <image src="../../assets/icons/water.svg" class="icon-svg" mode="aspectFit"></image>
            </view>
            <view class="data-info-list">
              <view class="data-info-row">
                <text class="data-title">ç”¨æ°´é‡</text>
                <view class="data-value-container">
                  <text class="data-value">{{overview.water.value}}</text>
                  <text class="data-unit">{{overview.water.unit}}</text>
                </view>
              </view>
            </view>
            <view class="data-trend {{overview.water.trend >= 0 ? 'up' : 'down'}}">
              <text class="trend-arrow">{{overview.water.trend >= 0 ? 'â†—' : 'â†˜'}}</text>
              <text class="trend-value">{{overview.water.trend}}%</text>
            </view>
          </view>
        </view>
        
        <!-- ç‡ƒæ°”é‡ç´¯è®¡ -->
        <view class="data-card-list glass-card energy-card-gas" wx:if="{{overview.gas}}">
          <view class="data-card-list-content">
            <view class="data-icon gas-icon">
              <image src="../../assets/icons/gas.svg" class="icon-svg" mode="aspectFit"></image>
            </view>
            <view class="data-info-list">
              <view class="data-info-row">
                <text class="data-title">ç‡ƒæ°”é‡</text>
                <view class="data-value-container">
                  <text class="data-value">{{overview.gas.value}}</text>
                  <text class="data-unit">{{overview.gas.unit}}</text>
                </view>
              </view>
            </view>
            <view class="data-trend {{overview.gas.trend >= 0 ? 'up' : 'down'}}">
              <text class="trend-arrow">{{overview.gas.trend >= 0 ? 'â†—' : 'â†˜'}}</text>
              <text class="trend-value">{{overview.gas.trend}}%</text>
            </view>
          </view>
        </view>
        
        <!-- ç¢³æ’æ”¾ç´¯è®¡ -->
        <view class="data-card-list glass-card energy-card-carbon" wx:if="{{overview.carbon}}">
          <view class="data-card-list-content">
            <view class="data-icon carbon-icon">
              <image src="../../assets/icons/carbon.svg" class="icon-svg" mode="aspectFit"></image>
            </view>
            <view class="data-info-list">
              <view class="data-info-row">
                <text class="data-title">ç¢³æ’æ”¾</text>
                <view class="data-value-container">
                  <text class="data-value">{{overview.carbon.value}}</text>
                  <text class="data-unit">{{overview.carbon.unit}}</text>
                </view>
              </view>
            </view>
            <view class="data-trend {{overview.carbon.trend >= 0 ? 'up' : 'down'}}">
              <text class="trend-arrow">{{overview.carbon.trend >= 0 ? 'â†—' : 'â†˜'}}</text>
              <text class="trend-value">{{overview.carbon.trend}}%</text>
            </view>
          </view>
        </view>
      </view>  
      
    </view>
    <view class="loading-placeholder" wx:else>
      <view class="loading-spinner"></view>
      <text class="loading-text">æ•°æ®åŠ è½½ä¸­...</text>
    </view>
    <!-- å¿«é€Ÿæ“ä½œæŒ‰é’® -->
    <view class="overview-actions" wx:if="{{!loading}}">
      <view class="action-btn" bindtap="goToDetail">
        <text class="action-text">è¯¦æƒ…</text>
      </view>
      <view class="action-btn" bindtap="goToAnalysis">
        <text class="action-text">åˆ†æ</text>
      </view>
      <view class="action-btn" bindtap="exportData">
        <text class="action-text">å¯¼å‡º</text>
      </view>
    </view>
  </view>

  <!-- å®æ—¶æ•°æ®ç›‘æ§ -->
  <view class="realtime-monitor glass-card" wx:if="{{!loading && monitorData.realTimeData}}">
    <view class="monitor-header">
      <text class="monitor-title">å®æ—¶æ•°æ®ç›‘æ§</text>
      <text class="monitor-subtitle">å½“å‰å®æ—¶çŠ¶æ€</text>
    </view>
    
    <!-- å®æ—¶æ•°æ®ç½‘æ ¼ -->
    <view class="data-grid">
    <!-- å®æ—¶åŠŸç‡å¡ç‰‡ -->
    <view class="data-card glass-card energy-card-electricity" bindtap="goToMonitor" data-type="power">
      <view class="data-icon power-icon">
        <image src="../../assets/icons/power.svg" class="icon-svg" mode="aspectFit"></image>
      </view>
      <view class="data-info">
        <text class="data-title">ç”¨ç”µåŠŸç‡</text>
        <view class="data-value-container">
          <text class="data-value">{{monitorData.realTimeData.power.value}}</text>
          <text class="data-unit">{{monitorData.realTimeData.power.unit}}</text>
        </view>
      </view>
      <view class="data-trend {{monitorData.realTimeData.power.trend}}">
        <text class="trend-arrow">{{monitorData.realTimeData.power.trend === 'up' ? 'â†—' : monitorData.realTimeData.power.trend === 'down' ? 'â†˜' : 'â†’'}}</text>
      </view>
    </view>

    <!-- ç”¨æ°´é‡å¡ç‰‡ -->
    <view class="data-card glass-card energy-card-water" bindtap="goToMonitor" data-type="water">
      <view class="data-icon water-icon">
        <image src="../../assets/icons/water.svg" class="icon-svg" mode="aspectFit"></image>
      </view>
      <view class="data-info">
        <text class="data-title">ç”¨æ°´æµé‡</text>
        <view class="data-value-container">
          <text class="data-value">{{monitorData.realTimeData.water.value}}</text>
          <text class="data-unit">{{monitorData.realTimeData.water.unit}}</text>
        </view>
      </view>
      <view class="data-trend {{monitorData.realTimeData.water.trend}}">
        <text class="trend-arrow">{{monitorData.realTimeData.water.trend === 'up' ? 'â†—' : monitorData.realTimeData.water.trend === 'down' ? 'â†˜' : 'â†’'}}</text>
      </view>
    </view>

    <!-- ç‡ƒæ°”é‡å¡ç‰‡ -->
    <view class="data-card glass-card energy-card-gas" bindtap="goToMonitor" data-type="gas">
      <view class="data-icon gas-icon">
        <image src="../../assets/icons/gas.svg" class="icon-svg" mode="aspectFit"></image>
      </view>
      <view class="data-info">
        <text class="data-title">ç‡ƒæ°”æµé‡</text>
        <view class="data-value-container">
          <text class="data-value">{{monitorData.realTimeData.gas.value}}</text>
          <text class="data-unit">{{monitorData.realTimeData.gas.unit}}</text>
        </view>
      </view>
      <view class="data-trend {{monitorData.realTimeData.gas.trend}}">
        <text class="trend-arrow">{{monitorData.realTimeData.gas.trend === 'up' ? 'â†—' : monitorData.realTimeData.gas.trend === 'down' ? 'â†˜' : 'â†’'}}</text>
      </view>
    </view>

    <!-- ç¢³æ’æ”¾å¡ç‰‡ -->
    <view class="data-card glass-card energy-card-carbon" bindtap="goToMonitor" data-type="carbon">
      <view class="data-icon carbon-icon">
        <image src="../../assets/icons/carbon.svg" class="icon-svg" mode="aspectFit"></image>
      </view>
      <view class="data-info">
        <text class="data-title">ç¢³æ’æ”¾ç‡</text>
        <view class="data-value-container">
          <text class="data-value">{{monitorData.realTimeData.carbon.value}}</text>
          <text class="data-unit">{{monitorData.realTimeData.carbon.unit}}</text>
        </view>
      </view>
      <view class="data-trend {{monitorData.realTimeData.carbon.trend}}">
        <text class="trend-arrow">{{monitorData.realTimeData.carbon.trend === 'up' ? 'â†—' : monitorData.realTimeData.carbon.trend === 'down' ? 'â†˜' : 'â†’'}}</text>
      </view>
    </view>
    </view>
  </view>
  
  <!-- æ•°æ®åŠ è½½çŠ¶æ€ -->
  <view class="realtime-monitor glass-card" wx:else>
    <view class="monitor-header">
      <text class="monitor-title">å®æ—¶æ•°æ®ç›‘æ§</text>
      <text class="monitor-subtitle">å½“å‰å®æ—¶çŠ¶æ€</text>
    </view>
    
    <view class="data-grid loading-grid">
    <view class="data-card glass-card loading-card" wx:for="{{[1,2,3,4]}}" wx:key="*this">
      <view class="loading-placeholder">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
    </view>
    </view>
  </view>

  <!-- ç”¨ç”µè´Ÿè·æ›²çº¿ -->
  <view class="chart-section glass-card">
    <view class="chart-header">
      <view class="chart-title-section">
        <text class="chart-title">ä»Šæ—¥ç”¨ç”µè´Ÿè· (kW)</text>
      </view>
      <view class="chart-tabs">
        <text class="chart-tab {{chartTab === 'today' ? 'active' : ''}}" bindtap="switchChartTab" data-tab="today">ä»Šæ—¥</text>
        <text class="chart-tab {{chartTab === 'week' ? 'active' : ''}}" bindtap="switchChartTab" data-tab="week">æœ¬å‘¨</text>
      </view>
    </view>
    <view class="chart-container">
      <canvas class="chart-canvas" id="powerChart" type="2d" disable-scroll="true" wx:if="{{chartData && !loading}}"></canvas>
      <view class="chart-loading" wx:else>
        <text class="loading-text">å›¾è¡¨æ•°æ®åŠ è½½ä¸­...</text>
      </view>
    </view>
  </view>

  <!-- è®¾å¤‡å‘Šè­¦æ¦‚è§ˆ -->
  <view class="alert-section glass-card" bindtap="goToAlerts">
    <view class="alert-header">
      <text class="alert-title">è®¾å¤‡å‘Šè­¦</text>
      <text class="alert-count" wx:if="{{!loading}}">{{alertCount}}æ¡æœªå¤„ç†</text>
      <text class="alert-count" wx:else>åŠ è½½ä¸­...</text>
    </view>
    <view class="alert-list" wx:if="{{!loading && alertCount > 0 && recentAlerts && recentAlerts.length > 0}}">
      <!-- ä¿®æ”¹è¿™é‡Œï¼Œä¸ºæ¯ä¸ªå‘Šè­¦é¡¹æ·»åŠ å•ç‹¬çš„ç‚¹å‡»äº‹ä»¶ï¼Œå¹¶ä¼ é€’å‘Šè­¦ID -->
      <view class="alert-item" wx:for="{{recentAlerts}}" wx:key="id" bindtap="goToAlertDetail" data-id="{{item.id}}">
        <view class="alert-dot {{item.level}}"></view>
        <text class="alert-text">{{item.message}}</text>
        <text class="alert-time">{{item.createdAt}}</text>
      </view>
    </view>
    <view class="no-alert" wx:elif="{{!loading && alertCount === 0}}">
      <text class="no-alert-text">æš‚æ— å‘Šè­¦ä¿¡æ¯</text>
      <text class="no-alert-icon">âœ…</text>
    </view>
    <view class="loading-placeholder" wx:else>
      <text class="loading-text">å‘Šè­¦æ•°æ®åŠ è½½ä¸­...</text>
    </view>
  </view>

  <!-- å¿«æ·æ§åˆ¶åŒºåŸŸ -->
  <view class="quick-control glass-card">
    <view class="control-header">
      <text class="control-title">å¿«æ·æ§åˆ¶</text>
      <text class="control-subtitle">ä¸€é”®æ“ä½œ</text>
    </view>
    <view class="control-grid">
      <view class="control-item" bindtap="quickSaveEnergy">
        <view class="control-icon save-icon">ğŸ’¡</view>
        <text class="control-text">èŠ‚èƒ½æ¨¡å¼</text>
      </view>
      <view class="control-item" bindtap="goToSceneMode">
        <view class="control-icon scene-icon">ğŸ¢</view>
        <text class="control-text">åœºæ™¯æ¨¡å¼</text>
      </view>
      <view class="control-item" bindtap="goToAutomation">
        <view class="control-icon automation-icon">âš™ï¸</view>
        <text class="control-text">è‡ªåŠ¨åŒ–è§„åˆ™</text>
      </view>

      <navigator url="/pages/group-management/group-management" class="control-item">
        <view class="control-icon">ğŸ‘¥</view>
        <text class="control-text">åˆ†ç»„ç®¡ç†</text>
      </navigator>
      <navigator url="/pages/intelligent-analysis/intelligent-analysis" class="control-item">
        <view class="control-icon">ğŸ¤–</view>
        <text class="control-text">æ™ºèƒ½åˆ†æ</text>
      </navigator>
    </view>
  </view>

  <!-- åº•éƒ¨å¯¼èˆªæç¤º -->
  <view class="bottom-tip">
    <text class="tip-text">ä¸Šæ»‘æŸ¥çœ‹æ›´å¤šåŠŸèƒ½</text>
    <text class="tip-arrow">â†‘</text>
  </view>
</view>