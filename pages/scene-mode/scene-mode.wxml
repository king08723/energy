<!--pages/scene-mode/scene-mode.wxml-->
<view class="energy-container">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="energy-bg-decoration">
    <view class="energy-bg-circle" style="width: 200rpx; height: 200rpx; top: 10%; right: -50rpx; animation-delay: 0s; opacity: 0.6;"></view>
    <view class="energy-bg-circle" style="width: 150rpx; height: 150rpx; top: 60%; left: -30rpx; animation-delay: 2s; opacity: 0.4;"></view>
    <view class="energy-bg-circle" style="width: 100rpx; height: 100rpx; top: 80%; right: 20%; animation-delay: 4s; opacity: 0.3;"></view>
  </view>

  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="energy-glass-card energy-p-32">
    <view class="energy-flex energy-flex-between energy-mb-24">
      <text class="energy-title-large">åœºæ™¯æ¨¡å¼ç®¡ç†</text>
      <view class="energy-flex">
        <!-- å®æ—¶åˆ·æ–°æŒ‡ç¤ºå™¨ -->
        <view class="refresh-indicator {{isRefreshing ? 'active' : ''}}" bindtap="onRefresh">
          <text class="energy-icon-text">ğŸ”„</text>
        </view>
      </view>
    </view>
    
    <!-- åœºæ™¯æ¨¡å¼ç»Ÿè®¡ -->
    <view class="energy-flex energy-flex-between energy-mb-24">
      <view class="scene-stat-item">
        <text class="energy-text-tertiary energy-text-small">åœºæ™¯æ€»æ•°</text>
        <text class="energy-title-medium energy-text-primary">{{sceneStats.total || 0}}</text>
      </view>
      <view class="scene-stat-item">
        <text class="energy-text-tertiary energy-text-small">å½“å‰æ¿€æ´»</text>
        <text class="energy-title-medium energy-text-success">{{sceneStats.active || 0}}</text>
      </view>
      <view class="scene-stat-item">
        <text class="energy-text-tertiary energy-text-small">è®¾å¤‡è¦†ç›–</text>
        <text class="energy-title-medium energy-text-primary">{{sceneStats.devicesCovered || 0}}</text>
      </view>
    </view>
  </view>

  <!-- å½“å‰æ¿€æ´»åœºæ™¯ -->
  <view class="energy-glass-card energy-p-24" wx:if="{{activeScene}}">
    <view class="energy-flex energy-flex-between energy-mb-16">
      <text class="energy-title-medium">å½“å‰æ¿€æ´»åœºæ™¯</text>
      <view class="active-scene-indicator">
        <view class="energy-status-dot energy-status-success"></view>
        <text class="energy-text-success energy-text-small">å·²æ¿€æ´»</text>
      </view>
    </view>
    
    <view class="active-scene-card">
      <view class="scene-icon">{{activeScene.icon || 'ğŸ­'}}</view>
      <view class="scene-info">
        <text class="energy-title-small">{{activeScene.name}}</text>
        <text class="energy-text-muted">{{activeScene.description}}</text>
        <text class="energy-text-tertiary energy-text-small">æ¿€æ´»æ—¶é—´: {{activeScene.lastActiveTime}}</text>
      </view>
      <view class="scene-devices">
        <text class="energy-text-tertiary energy-text-small">åŒ…å«è®¾å¤‡: {{activeScene.devices.length}}å°</text>
      </view>
    </view>
  </view>

  <!-- åœºæ™¯æ¨¡å¼åˆ—è¡¨ -->
  <view class="energy-glass-card energy-p-24">
    <view class="energy-flex energy-flex-between energy-mb-16">
      <text class="energy-title-medium">åœºæ™¯æ¨¡å¼åˆ—è¡¨</text>
      <view class="scene-filter" bindtap="toggleFilter">
        <text class="energy-text-tertiary energy-text-small">{{filterType === 'all' ? 'å…¨éƒ¨' : filterType === 'office' ? 'åŠå…¬' : filterType === 'factory' ? 'å·¥å‚' : 'å­¦æ ¡'}}</text>
        <text class="filter-icon">âŒ„</text>
      </view>
    </view>
    
    <!-- ç­›é€‰ä¸‹æ‹‰èœå• -->
    <view class="filter-dropdown" wx:if="{{showFilter}}">
      <view class="filter-item {{filterType === 'all' ? 'active' : ''}}" bindtap="onFilterType" data-type="all">
        <text>å…¨éƒ¨åœºæ™¯</text>
      </view>
      <view class="filter-item {{filterType === 'office' ? 'active' : ''}}" bindtap="onFilterType" data-type="office">
        <text>åŠå…¬åœºæ™¯</text>
      </view>
      <view class="filter-item {{filterType === 'factory' ? 'active' : ''}}" bindtap="onFilterType" data-type="factory">
        <text>å·¥å‚åœºæ™¯</text>
      </view>
      <view class="filter-item {{filterType === 'school' ? 'active' : ''}}" bindtap="onFilterType" data-type="school">
        <text>å­¦æ ¡åœºæ™¯</text>
      </view>
    </view>
    
    <!-- åœºæ™¯åˆ—è¡¨ -->
    <view class="scene-list">
      <view class="scene-empty" wx:if="{{filteredScenes.length === 0}}">
        <text class="energy-text-muted">æš‚æ— åœºæ™¯æ¨¡å¼</text>
      </view>
      
      <view class="scene-item energy-glass-card energy-p-16" wx:for="{{filteredScenes}}" wx:key="id">
        <view class="scene-header energy-flex energy-flex-between">
          <view class="scene-title-area">
            <text class="scene-icon">{{item.icon || (item.type === 'factory' ? 'ğŸ­' : item.type === 'school' ? 'ğŸ«' : 'ğŸ¢')}}</text>
            <text class="energy-title-small">{{item.name}}</text>
          </view>
          <view class="scene-status {{item.isActive ? 'active' : ''}}">
            <view class="energy-status-dot {{item.isActive ? 'energy-status-success' : ''}}"></view>
            <text class="energy-text-small {{item.isActive ? 'energy-text-success' : 'energy-text-muted'}}">{{item.isActive ? 'å·²å¯ç”¨' : 'æœªå¯ç”¨'}}</text>
          </view>
        </view>
        
        <view class="scene-description energy-mb-16">
          <text class="energy-text-muted">{{item.description}}</text>
        </view>
        
        <view class="scene-devices energy-mb-16">
          <text class="energy-text-tertiary energy-text-small">åŒ…å«è®¾å¤‡: {{item.devices.length}}å°</text>
        </view>
        
        <view class="scene-actions energy-flex energy-flex-between">
          <button class="scene-btn {{item.isActive ? 'disabled' : ''}}" bindtap="onSwitchScene" data-id="{{item.id}}" disabled="{{item.isActive}}">
            {{item.isActive ? 'å·²å¯ç”¨' : 'ä¸€é”®å¯ç”¨'}}
          </button>
          <button class="scene-btn edit" bindtap="onEditScene" data-id="{{item.id}}">
            ç¼–è¾‘
          </button>
          <button class="scene-btn delete" bindtap="onDeleteScene" data-id="{{item.id}}">
            åˆ é™¤
          </button>
        </view>
      </view>
    </view>
  </view>
  
  <!-- æ·»åŠ æ–°åœºæ™¯æŒ‰é’® -->
  <view class="add-scene-btn" bindtap="onAddScene">
    <text class="add-icon">+</text>
    <text class="add-text">æ·»åŠ åœºæ™¯æ¨¡å¼</text>
  </view>
</view>