<!--pages/saving/saving.wxml-->
<view class="energy-container">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="energy-bg-decoration">
    <view class="energy-bg-circle" style="width: 200rpx; height: 200rpx; top: 10%; left: -50rpx; animation-delay: 0s;"></view>
    <view class="energy-bg-circle" style="width: 150rpx; height: 150rpx; top: 30%; right: -30rpx; animation-delay: 2s;"></view>
    <view class="energy-bg-circle" style="width: 100rpx; height: 100rpx; top: 60%; left: 20%; animation-delay: 4s;"></view>
    <view class="energy-bg-circle" style="width: 120rpx; height: 120rpx; bottom: 20%; right: 10%; animation-delay: 6s;"></view>
  </view>

  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="energy-glass-card energy-p-32 energy-mb-24">
    <view class="energy-flex energy-flex-between energy-mb-16">
      <text class="energy-title-large">èŠ‚èƒ½æ–¹æ¡ˆ</text>
      <view class="energy-flex">
        <view class="energy-icon energy-mr-16" bindtap="onRefresh">
          <text class="energy-icon-text {{refreshing ? 'rotating' : ''}}">ğŸ”„</text>
        </view>
      </view>
    </view>
    <view class="energy-text-tertiary">æ™ºèƒ½åˆ†æï¼Œä¸ªæ€§åŒ–èŠ‚èƒ½å»ºè®®</view>
  </view>

  <!-- èŠ‚èƒ½æ¦‚è§ˆ -->
  <view class="energy-glass-card energy-p-24 energy-mb-24">
    <view class="energy-title-small energy-mb-16">èŠ‚èƒ½æ½œåŠ›æ¦‚è§ˆ</view>
    <view class="saving-overview-grid">
      <view class="saving-overview-item">
        <view class="overview-icon energy">âš¡</view>
        <view class="overview-content">
          <text class="overview-value">{{overview.totalSavingPotential}}</text>
          <text class="overview-unit">kWh</text>
          <text class="overview-label">æ—¥èŠ‚èƒ½æ½œåŠ›</text>
        </view>
      </view>
      <view class="saving-overview-item">
        <view class="overview-icon cost">ğŸ’°</view>
        <view class="overview-content">
          <text class="overview-value">{{overview.costSavingPotential}}</text>
          <text class="overview-unit">å…ƒ</text>
          <text class="overview-label">æ—¥èŠ‚çº¦æ½œåŠ›</text>
        </view>
      </view>
      <view class="saving-overview-item">
        <view class="overview-icon carbon">ğŸŒ±</view>
        <view class="overview-content">
          <text class="overview-value">{{overview.carbonReductionPotential}}</text>
          <text class="overview-unit">kg</text>
          <text class="overview-label">æ—¥å‡ç¢³æ½œåŠ›</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
  <view class="saving-tabs energy-mb-24">
    <view class="tab-item {{activeTab === 'plans' ? 'active' : ''}}" bindtap="onTabChange" data-tab="plans">
      <text class="tab-icon">ğŸ“‹</text>
      <text class="tab-text">èŠ‚èƒ½æ–¹æ¡ˆ</text>
    </view>
    <view class="tab-item {{activeTab === 'tips' ? 'active' : ''}}" bindtap="onTabChange" data-tab="tips">
      <text class="tab-icon">ğŸ’¡</text>
      <text class="tab-text">èŠ‚èƒ½è´´å£«</text>
    </view>
    <view class="tab-item {{activeTab === 'achievements' ? 'active' : ''}}" bindtap="onTabChange" data-tab="achievements">
      <text class="tab-icon">ğŸ†</text>
      <text class="tab-text">èŠ‚èƒ½æˆæœ</text>
    </view>
    <view class="tab-item {{activeTab === 'goals' ? 'active' : ''}}" bindtap="onTabChange" data-tab="goals">
      <text class="tab-icon">ğŸ¯</text>
      <text class="tab-text">èŠ‚èƒ½ç›®æ ‡</text>
    </view>
    <view class="tab-item {{activeTab === 'knowledge' ? 'active' : ''}}" bindtap="onTabChange" data-tab="knowledge">
      <text class="tab-icon">ğŸ“š</text>
      <text class="tab-text">çŸ¥è¯†åº“</text>
    </view>
  </view>

  <!-- èŠ‚èƒ½æ–¹æ¡ˆæ ‡ç­¾é¡µ -->
  <view wx:if="{{activeTab === 'plans'}}" class="tab-content">
    <!-- ç­›é€‰å™¨ -->
    <view class="energy-glass-card energy-p-20 energy-mb-16">
      <view class="filter-section">
        <text class="filter-label">åˆ†ç±»ç­›é€‰ï¼š</text>
        <view class="filter-tags">
          <text class="filter-tag {{filters.planCategory === 'all' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="planCategory" data-value="all">å…¨éƒ¨</text>
          <text class="filter-tag {{filters.planCategory === 'temperature' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="planCategory" data-value="temperature">æ¸©æ§</text>
          <text class="filter-tag {{filters.planCategory === 'lighting' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="planCategory" data-value="lighting">ç…§æ˜</text>
          <text class="filter-tag {{filters.planCategory === 'equipment' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="planCategory" data-value="equipment">è®¾å¤‡</text>
          <text class="filter-tag {{filters.planCategory === 'monitoring' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="planCategory" data-value="monitoring">ç›‘æ§</text>
        </view>
      </view>
      <view class="filter-section">
        <text class="filter-label">ä¼˜å…ˆçº§ï¼š</text>
        <view class="filter-tags">
          <text class="filter-tag {{filters.planPriority === 'all' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="planPriority" data-value="all">å…¨éƒ¨</text>
          <text class="filter-tag {{filters.planPriority === 'high' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="planPriority" data-value="high">é«˜</text>
          <text class="filter-tag {{filters.planPriority === 'medium' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="planPriority" data-value="medium">ä¸­</text>
          <text class="filter-tag {{filters.planPriority === 'low' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="planPriority" data-value="low">ä½</text>
        </view>
      </view>
    </view>

    <!-- æ–¹æ¡ˆåˆ—è¡¨ -->
    <view class="saving-plans-list">
      <view wx:for="{{savingPlans}}" wx:key="id" class="energy-glass-card energy-p-24 energy-mb-16 saving-plan-item">
        <view class="plan-header">
          <view class="plan-title-section">
            <text class="plan-title">{{item.title}}</text>
            <view class="plan-badges">
              <text class="priority-badge priority-{{item.priority}}">{{item.priority === 'high' ? 'é«˜ä¼˜å…ˆçº§' : item.priority === 'medium' ? 'ä¸­ä¼˜å…ˆçº§' : 'ä½ä¼˜å…ˆçº§'}}</text>
              <text class="status-badge status-{{item.status}}">
                {{item.status === 'recommended' ? 'æ¨è' : item.status === 'in_progress' ? 'è¿›è¡Œä¸­' : item.status === 'planned' ? 'è®¡åˆ’ä¸­' : 'è¯„ä¼°ä¸­'}}
              </text>
            </view>
          </view>
          <view class="plan-actions">
            <text class="action-btn" bindtap="togglePlanDetail" data-plan-id="{{item.id}}">
              {{expandedItems.plans[item.id] ? 'æ”¶èµ·' : 'è¯¦æƒ…'}}
            </text>
          </view>
        </view>

        <view class="plan-description energy-mb-16">
          <text class="energy-text-secondary">{{item.description}}</text>
        </view>

        <view class="plan-savings energy-mb-16">
          <view class="saving-item">
            <text class="saving-label">é¢„è®¡èŠ‚èƒ½</text>
            <text class="saving-value">{{item.estimatedSaving.energy}} kWh</text>
          </view>
          <view class="saving-item">
            <text class="saving-label">é¢„è®¡èŠ‚çº¦</text>
            <text class="saving-value">{{item.estimatedSaving.cost}} å…ƒ</text>
          </view>
          <view class="saving-item">
            <text class="saving-label">å‡å°‘ç¢³æ’æ”¾</text>
            <text class="saving-value">{{item.estimatedSaving.carbon}} kg</text>
          </view>
        </view>

        <!-- å±•å¼€çš„è¯¦ç»†ä¿¡æ¯ -->
        <view wx:if="{{expandedItems.plans[item.id]}}" class="plan-details">
          <view class="detail-section">
            <text class="detail-title">å®æ–½ä¿¡æ¯</text>
            <view class="detail-grid">
              <view class="detail-item">
                <text class="detail-label">éš¾åº¦</text>
                <text class="detail-value">{{item.implementation.difficulty}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-label">æ—¶é—´</text>
                <text class="detail-value">{{item.implementation.timeRequired}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-label">æŠ•èµ„</text>
                <text class="detail-value">{{item.implementation.investment}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-label">å›æŠ¥å‘¨æœŸ</text>
                <text class="detail-value">{{item.implementation.roi}}</text>
              </view>
            </view>
          </view>

          <view class="detail-section">
            <text class="detail-title">å®æ–½æ­¥éª¤</text>
            <view class="action-list">
              <view wx:for="{{item.actions}}" wx:for-item="action" wx:key="*this" class="action-item">
                <text class="action-number">{{index + 1}}</text>
                <text class="action-text">{{action}}</text>
              </view>
            </view>
          </view>
        </view>

        <view class="plan-footer">
          <view class="plan-buttons">
            <text class="btn-secondary" bindtap="viewPlanDetail" data-plan-id="{{item.id}}">æŸ¥çœ‹è¯¦æƒ…</text>
            <text class="btn-primary" bindtap="executePlan" data-plan-id="{{item.id}}">æ‰§è¡Œæ–¹æ¡ˆ</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- èŠ‚èƒ½è´´å£«æ ‡ç­¾é¡µ -->
  <view wx:if="{{activeTab === 'tips'}}" class="tab-content">
    <!-- åˆ†ç±»ç­›é€‰ -->
    <view class="energy-glass-card energy-p-20 energy-mb-16">
      <view class="filter-section">
        <text class="filter-label">åˆ†ç±»ç­›é€‰ï¼š</text>
        <view class="filter-tags">
          <text class="filter-tag {{filters.tipCategory === 'all' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="tipCategory" data-value="all">å…¨éƒ¨</text>
          <text class="filter-tag {{filters.tipCategory === 'daily' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="tipCategory" data-value="daily">æ—¥å¸¸</text>
          <text class="filter-tag {{filters.tipCategory === 'lighting' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="tipCategory" data-value="lighting">ç…§æ˜</text>
          <text class="filter-tag {{filters.tipCategory === 'equipment' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="tipCategory" data-value="equipment">è®¾å¤‡</text>
          <text class="filter-tag {{filters.tipCategory === 'water' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="tipCategory" data-value="water">ç”¨æ°´</text>
        </view>
      </view>
    </view>

    <!-- è´´å£«åˆ—è¡¨ -->
    <view class="saving-tips-list">
      <view wx:for="{{savingTips}}" wx:key="id" class="energy-glass-card energy-p-24 energy-mb-16 saving-tip-item">
        <view class="tip-header">
          <text class="tip-icon">{{item.icon}}</text>
          <view class="tip-info">
            <text class="tip-title">{{item.title}}</text>
            <view class="tip-badges">
              <text class="difficulty-badge difficulty-{{item.difficulty}}">{{item.difficulty === 'easy' ? 'ç®€å•' : 'ä¸­ç­‰'}}</text>
              <text class="potential-badge potential-{{item.savingPotential}}">{{item.savingPotential === 'high' ? 'é«˜æ•ˆæœ' : 'ä¸­æ•ˆæœ'}}</text>
            </view>
          </view>
          <view class="tip-actions">
            <text class="action-btn" bindtap="shareTip" data-tip-id="{{item.id}}">åˆ†äº«</text>
          </view>
        </view>
        <view class="tip-content">
          <text class="energy-text-secondary">{{item.content}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- èŠ‚èƒ½æˆæœæ ‡ç­¾é¡µ -->
  <view wx:if="{{activeTab === 'achievements'}}" class="tab-content">
    <!-- æˆæœæ¦‚è§ˆ -->
    <view class="energy-glass-card energy-p-24 energy-mb-16">
      <text class="energy-title-small energy-mb-16">ç´¯è®¡æˆæœ</text>
      <view class="achievement-summary">
        <view class="achievement-item" bindtap="viewAchievementDetail" data-type="energy">
          <view class="achievement-icon energy">âš¡</view>
          <view class="achievement-content">
            <text class="achievement-value">{{achievements.summary.totalEnergySaved}}</text>
            <text class="achievement-unit">kWh</text>
            <text class="achievement-label">ç´¯è®¡èŠ‚èƒ½</text>
          </view>
        </view>
        <view class="achievement-item" bindtap="viewAchievementDetail" data-type="cost">
          <view class="achievement-icon cost">ğŸ’°</view>
          <view class="achievement-content">
            <text class="achievement-value">{{achievements.summary.totalCostSaved}}</text>
            <text class="achievement-unit">å…ƒ</text>
            <text class="achievement-label">ç´¯è®¡èŠ‚çº¦</text>
          </view>
        </view>
        <view class="achievement-item" bindtap="viewAchievementDetail" data-type="carbon">
          <view class="achievement-icon carbon">ğŸŒ±</view>
          <view class="achievement-content">
            <text class="achievement-value">{{achievements.summary.totalCarbonReduced}}</text>
            <text class="achievement-unit">kg</text>
            <text class="achievement-label">ç´¯è®¡å‡ç¢³</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åˆ†ç±»æˆæœ -->
    <view class="energy-glass-card energy-p-24 energy-mb-16">
      <text class="energy-title-small energy-mb-16">åˆ†ç±»æˆæœ</text>
      <view class="category-achievements">
        <view wx:for="{{achievements.categories}}" wx:key="category" class="category-item">
          <view class="category-header">
            <text class="category-name">{{item.name}}</text>
            <text class="category-percentage">{{item.percentage}}%</text>
          </view>
          <view class="category-progress">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{item.percentage}}%"></view>
            </view>
            <text class="category-value">{{item.energySaved}} kWh</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æˆå°±é‡Œç¨‹ç¢‘ -->
    <view class="energy-glass-card energy-p-24 energy-mb-16">
      <text class="energy-title-small energy-mb-16">æˆå°±é‡Œç¨‹ç¢‘</text>
      <view class="milestones-list">
        <view wx:for="{{achievements.milestones}}" wx:key="id" class="milestone-item">
          <view class="milestone-icon">ğŸ†</view>
          <view class="milestone-content">
            <text class="milestone-title">{{item.title}}</text>
            <text class="milestone-description">{{item.description}}</text>
            <text class="milestone-date">{{item.achievedDate}}</text>
          </view>
          <view class="milestone-reward">
            <text class="reward-badge">{{item.reward}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- èŠ‚èƒ½ç›®æ ‡æ ‡ç­¾é¡µ -->
  <view wx:if="{{activeTab === 'goals'}}" class="tab-content">
    <!-- å½“å‰ç›®æ ‡ -->
    <view class="energy-glass-card energy-p-24 energy-mb-16">
      <view class="goal-header">
        <text class="energy-title-small">{{goals.current.title}}</text>
        <text class="goal-status status-{{goals.current.status}}">è¿›è¡Œä¸­</text>
      </view>
      
      <view class="goal-progress energy-mb-16">
        <view class="progress-item">
          <text class="progress-label">èŠ‚èƒ½ç‡è¿›åº¦</text>
          <view class="progress-bar-container">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{(goals.current.currentSavingRate / goals.current.targetSavingRate) * 100}}%"></view>
            </view>
            <text class="progress-text">{{goals.current.currentSavingRate}}% / {{goals.current.targetSavingRate}}%</text>
          </view>
        </view>
        
        <view class="progress-item">
          <text class="progress-label">èŠ‚èƒ½é‡è¿›åº¦</text>
          <view class="progress-bar-container">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{(goals.current.currentEnergySaving / goals.current.targetEnergySaving) * 100}}%"></view>
            </view>
            <text class="progress-text">{{goals.current.currentEnergySaving}} / {{goals.current.targetEnergySaving}} kWh</text>
          </view>
        </view>
      </view>

      <view class="goal-actions">
        <text class="btn-primary" bindtap="setSavingGoal">è°ƒæ•´ç›®æ ‡</text>
      </view>
    </view>

    <!-- ç›®æ ‡å»ºè®® -->
    <view class="energy-glass-card energy-p-24 energy-mb-16">
      <text class="energy-title-small energy-mb-16">ç›®æ ‡å»ºè®®</text>
      <view class="suggestions-list">
        <view wx:for="{{goals.suggestions}}" wx:key="type" class="suggestion-item">
          <text class="suggestion-title">{{item.title}}</text>
          <text class="suggestion-description">{{item.description}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- çŸ¥è¯†åº“æ ‡ç­¾é¡µ -->
  <view wx:if="{{activeTab === 'knowledge'}}" class="tab-content">
    <!-- åˆ†ç±»ç­›é€‰ -->
    <view class="energy-glass-card energy-p-20 energy-mb-16">
      <view class="filter-section">
        <text class="filter-label">åˆ†ç±»ç­›é€‰ï¼š</text>
        <view class="filter-tags">
          <text class="filter-tag {{filters.knowledgeCategory === 'all' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="knowledgeCategory" data-value="all">å…¨éƒ¨</text>
          <text class="filter-tag {{filters.knowledgeCategory === 'basic' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="knowledgeCategory" data-value="basic">åŸºç¡€</text>
          <text class="filter-tag {{filters.knowledgeCategory === 'technology' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="knowledgeCategory" data-value="technology">æŠ€æœ¯</text>
          <text class="filter-tag {{filters.knowledgeCategory === 'practice' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="knowledgeCategory" data-value="practice">å®è·µ</text>
          <text class="filter-tag {{filters.knowledgeCategory === 'policy' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="knowledgeCategory" data-value="policy">æ”¿ç­–</text>
          <text class="filter-tag {{filters.knowledgeCategory === 'case' ? 'active' : ''}}" bindtap="onPlanFilter" data-type="knowledgeCategory" data-value="case">æ¡ˆä¾‹</text>
        </view>
      </view>
    </view>

    <!-- çŸ¥è¯†åˆ—è¡¨ -->
    <view class="knowledge-list">
      <view wx:for="{{knowledgeBase}}" wx:key="id" class="energy-glass-card energy-p-24 energy-mb-16 knowledge-item">
        <view class="knowledge-header" bindtap="toggleKnowledgeDetail" data-knowledge-id="{{item.id}}">
          <view class="knowledge-info">
            <text class="knowledge-title">{{item.title}}</text>
            <text class="knowledge-summary">{{item.summary}}</text>
            <view class="knowledge-meta">
              <text class="read-time">ğŸ“– {{item.readTime}}åˆ†é’Ÿ</text>
              <text class="difficulty difficulty-{{item.difficulty}}">{{item.difficulty === 'beginner' ? 'å…¥é—¨' : item.difficulty === 'intermediate' ? 'ä¸­çº§' : 'é«˜çº§'}}</text>
            </view>
          </view>
          <view class="knowledge-toggle">
            <text class="toggle-icon">{{expandedItems.knowledge[item.id] ? 'â–¼' : 'â–¶'}}</text>
          </view>
        </view>

        <view wx:if="{{expandedItems.knowledge[item.id]}}" class="knowledge-content">
          <text class="knowledge-text">{{item.content}}</text>
          <view class="knowledge-tags">
            <text wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this" class="knowledge-tag">{{tag}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="energy-glass-card energy-p-32 energy-flex-center">
    <text class="energy-text-secondary">åŠ è½½ä¸­...</text>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions energy-mb-32">
    <view class="energy-glass-card energy-p-24">
      <text class="energy-title-small energy-mb-16">å¿«æ·æ“ä½œ</text>
      <view class="action-buttons">
        <view class="action-button" bindtap="navigateToDevices">
          <text class="action-icon">ğŸ”Œ</text>
          <text class="action-text">è®¾å¤‡ç®¡ç†</text>
        </view>
        <view class="action-button" bindtap="navigateToData">
          <text class="action-icon">ğŸ“Š</text>
          <text class="action-text">æ•°æ®åˆ†æ</text>
        </view>
      </view>
    </view>
  </view>

  <custom-footer></custom-footer>
</view>