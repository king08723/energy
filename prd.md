# 微信小程序产品需求文档 (PRD) - 智慧能源管理

## 1. 项目概述 (Project Overview)

### 小程序名称与Slogan

*   **小程序名称：** 智慧能源管理
*   **Slogan：** 待定（可根据最终产品定位和市场策略确定）

### 核心愿景与价值主张

本小程序旨在通过集成智能硬件、数据分析与自动化控制，为用户提供一站式的智慧能源管理解决方案，核心价值在于：

*   **提升能源效率：** 帮助用户精细化管理各类能源消耗，减少浪费。
*   **降低能耗成本：** 通过数据分析和节能建议，指导用户优化用能习惯，节约开支。
*   **实现绿色低碳：** 促进清洁能源使用，助力用户减少碳排放。
*   **优化设备运行：** 实时监控设备状态，提升设备运行效率和安全性。

### 主要解决的能源管理问题与独特价值

小程序主要解决以下痛点：

*   **能耗不透明：** 用户无法清晰了解能源消耗的构成和趋势。
*   **管理不便捷：** 传统能源设备控制方式单一，缺乏远程和自动化能力。
*   **节能无依据：** 用户缺乏专业的能耗分析和个性化的节能指导。
*   **设备运维难：** 无法及时发现设备异常，影响正常运行和安全。

独特价值在于：

*   **多能源类型统一管理：** 支持电力、水、燃气等多种能源数据的统一采集和展示。
*   **软硬件深度融合：** 提供从数据采集、设备控制到数据分析、节能建议的全链路服务。
*   **场景化智能控制：** 针对工厂、学校、楼宇等特定场景提供定制化的自动化控制方案。

### 目标用户群体

*   **企业用户：** 工厂能源负责人、企业园区管理者、物业管理者。
*   **机构用户：** 学校后勤管理人员、公共建筑运营方。

### 主要涉及能源类型

*   电力
*   燃气
*   水
*   太阳能（光伏发电）
*   储能

### 管理范围

*   单个设备
*   单个家庭/办公室
*   整个楼宇/园区
*   多站点

## 2. 背景与商业目标 (Background & Business Goals)

### 背景

当前能源管理存在以下痛点和市场机遇：

*   **能耗浪费严重：** 缺乏精细化管理手段，导致能源使用效率低下。
*   **运维成本高昂：** 传统人工巡检和维护效率低，故障响应不及时。
*   **碳排放压力：** 政策法规对节能减排要求日益严格，企业面临转型压力。
*   **智能设备普及：** IoT技术和智能硬件的成熟为智慧能源管理提供了技术基础。

### 商业目标

*   **提升能源管理效率：** 帮助用户实现能耗的精细化管理和优化。
*   **降低运营成本：** 通过自动化控制和数据分析，减少人工干预和能源浪费。
*   **增强用户粘性：** 提供便捷、智能的能源管理体验，提升用户满意度。
*   **拓展市场份额：** 在智慧能源管理领域建立品牌影响力。

### 关键绩效指标 (KPI) 初步设想

*   月均能耗降低百分比（用户侧）
*   设备在线率
*   自动化场景执行成功率
*   告警处理及时率
*   用户活跃度（月活/日活）

## 2.5 UI设计规范与视觉风格 (UI Design Guidelines & Visual Style)

### 设计理念

本小程序采用高级、科技感的深色主题设计，旨在营造专业、现代的智慧能源管理体验。设计理念包括：

*   **专业性：** 深色背景配合青色强调色，体现能源管理的专业性和严谨性
*   **科技感：** 毛玻璃效果、渐变背景、发光文字等元素增强科技氛围
*   **层次感：** 通过阴影、边框、透明度营造视觉层次
*   **一致性：** 统一的配色方案、组件样式和交互反馈

### 核心配色方案

*   **主背景：** 深蓝到深灰渐变 (`linear-gradient(135deg, #0f1419 0%, #1a2332 100%)`)
*   **强调色：** 青色 (`#00ffff`) - 用于重要元素和交互状态
*   **主文字：** 白色 (`#ffffff`) - 带文字阴影增强可读性
*   **辅助文字：** 半透明白色 (`rgba(255, 255, 255, 0.7)`)
*   **状态色：**
    *   成功/正常：绿色 (`#00ff88`)
    *   警告：黄色 (`#ffaa00`)
    *   危险/故障：红色 (`#ff4444`)

### 核心组件样式

#### 毛玻璃卡片
*   半透明背景：`rgba(26, 35, 50, 0.6)` 到 `rgba(15, 20, 25, 0.8)` 渐变
*   模糊滤镜：`backdrop-filter: blur(20rpx)`
*   边框：`1px solid rgba(0, 255, 255, 0.2)`
*   圆角：`16rpx`
*   阴影：`0 8rpx 32rpx rgba(0, 0, 0, 0.3)`

#### 按钮与控件
*   背景：线性渐变 + 半透明效果
*   边框：青色半透明边框
*   悬停效果：阴影增强 + 边框高亮
*   过渡动画：`transition: all 0.3s ease`

#### 图标设计
*   圆形背景：渐变色彩区分不同类型
*   统一尺寸：48rpx × 48rpx (小图标) / 68rpx × 68rpx (大图标)
*   阴影效果：增强立体感

### 动画效果

*   **背景装饰：** 浮动的半透明圆圈动画
*   **加载状态：** 脉冲和闪烁效果
*   **交互反馈：** 按钮点击、悬停的平滑过渡
*   **页面切换：** 淡入淡出效果

### 设计系统文件

为确保整个小程序风格一致性，已创建统一的设计系统文件：

*   **核心样式文件：** `/styles/design-system.wxss`
*   **使用指南：** `/styles/README.md`
*   **示例页面：** `/styles/example-page.wxml`

所有页面开发时应引入设计系统文件并使用预定义的CSS类名，确保视觉风格的统一性。

### 响应式设计

*   适配不同屏幕尺寸的微信小程序设备
*   使用rpx单位确保在不同设备上的一致显示
*   针对小屏幕优化布局和字体大小

## 3. 用户画像与用户旅程 (User Persona & User Journey)

### 用户画像

*   **工厂能源负责人：** 关注生产能耗、设备运行效率、成本控制、碳排放合规。希望通过系统实现能耗可视化、异常预警、节能优化。
*   **学校后勤管理人员：** 关注公共区域能耗、设备安全、学生用电安全、节能教育。希望实现分区域能耗管理、定时开关、异常告警。
*   **楼宇物业管理者：** 关注楼宇公共能耗、租户能耗、设备维护、运营成本。希望实现多租户管理、分项计量、远程控制、故障预警。

### 用户旅程

1.  **发现与接入：** 用户通过微信搜索或推荐进入小程序，注册/登录，绑定智能设备或接入能源数据。
2.  **日常监控：** 用户打开小程序，查看实时能耗数据、设备状态、告警信息。
3.  **设备控制：** 用户远程控制设备开关、模式调节，或设置自动化规则。
4.  **数据分析：** 用户查看历史能耗报告，了解能耗趋势和构成。
5.  **异常处理：** 用户收到异常告警通知，进入小程序查看详情并处理。
6.  **节能优化：** 用户根据能耗报告和系统建议，调整用能策略。

### 用户痛点与期望解决的问题

*   **痛点：** 能耗数据不透明、设备无法远程控制、缺乏有效节能建议、设备故障预警不及时。
*   **期望：** 清晰掌握能耗数据、便捷控制设备、获得专业节能指导、及时发现并处理设备异常。

## 4. 核心功能与特性 (Core Features & Functionality)

### 核心监控与数据展示

*   **实时能耗数据展示：** 总能耗、分时能耗、分区域/分设备能耗。
*   **历史能耗数据查询与曲线图：** 支持日/周/月/年维度查询，展示能耗趋势。
*   **用电负荷分析与趋势预测：** 对用电负荷进行分析，提供短期趋势预测。
*   **碳排放量计算与展示：** 根据能耗数据自动计算碳排放量。
*   **能耗排名与对比：** 支持同类型区域或设备间的能耗对比。

### 设备控制与自动化

*   **远程控制智能设备：** 支持智能插座、空调、照明、热水器、水表、智能开关、智能电表/采集器、燃气表/热力表、各种传感器、智能网关、工业控制设备、新能源设备（如光伏逆变器、储能PCS）的开关、模式调节、参数设置。

*   **设备分组管理：**
    *   **分组创建与编辑：** 支持创建自定义设备分组，如生产区域、办公区域、公共区域等，可编辑分组名称、描述和图标。
    *   **设备分组归属：** 每个设备可归属到一个或多个分组，支持批量设备分组操作。
    *   **分组权限控制：** 不同用户角色可配置不同分组的查看和控制权限。
    *   **分组统计与监控：** 按分组统计能耗数据、设备状态，提供分组级别的监控视图。
    *   **分组批量操作：** 支持按分组进行批量设备控制，如一键关闭某分组所有设备。
*   **自动化规则设置：**
    *   **场景模式管理：**
        *   **工厂场景：**
            *   **生产模式：** 开启生产线相关设备，照明、空调按预设参数运行。
            *   **非生产模式：** 关闭非必要设备，照明、空调进入低能耗模式。
            *   **节假日模式：** 仅保留安防、消防等必要设备运行，其他设备关闭或休眠。
        *   **学校场景：**
            *   **上课模式：** 教室照明、空调按课表自动调节，公共区域照明开启。
            *   **下课模式：** 教室照明、空调进入节能模式或关闭，公共区域照明保持。
            *   **放学模式：** 大部分设备关闭，仅保留安防、夜间照明。
            *   **假期模式：** 仅保留安防、消防等必要设备运行，其他设备关闭或休眠。
        *   **楼宇场景：**
            *   **工作日模式：** 办公区域照明、空调按工作时间自动运行，公共区域照明开启。
            *   **非工作日模式：** 办公区域设备关闭，公共区域照明进入节能模式。
            *   **夜间模式：** 大部分设备关闭，仅保留安防、应急照明。

### 数据分析与节能建议

*   **异常能耗告警与通知：**
    *   **触发条件：** 能耗数据远超历史同期、设备离线、设备报告异常。
    *   **通知方式：** 小程序消息推送、短信、邮件（用户可自行开启/关闭）。
    *   **告警信息内容：** 设备名称、位置、异常类型、发生时间、当前能耗数据。
*   **能耗报告与诊断：**
    *   **报告类型：** 月度报告、年度报告、自定义时间段报告。
    *   **报告内容：** 能耗分类汇总分析。

### 集成与兼容性

*   **设备与协议支持：** 支持智能电表、传感器、网关、Modbus、Zigbee、Wi-Fi设备、LoRaWAN等多种智能设备和协议。
*   **统一对接模块：** 通过统一的对接模块处理不同设备和协议的数据采集、命令下发、协议转换等。

### 管理与权限

*   **多地点/多设备/多区域管理能力：** 支持对不同地点、设备、区域进行统一管理。
*   **用户与权限管理：** 区分管理员、普通用户、访客等不同角色，配置相应权限。

### 其他特色功能

*   **光伏发电监控：** 实时监控光伏发电量、发电功率、历史发电数据、发电收益估算、设备运行状态（如逆变器状态、组件温度）。
*   **储能系统管理：** 监控储能系统充放电状态、电池健康度（SOH）、循环次数、能量吞吐量、充放电策略设置、故障预警。
*   **充电桩管理：** 监控充电桩状态（空闲/充电中）、充电功率、充电量、充电费用、预约充电、远程启停、故障告警。

## 5. 非功能性需求 (Non-functional Requirements)

### 性能要求

*   **数据采集与展示实时性：** 核心能耗数据秒级更新，图表加载速度毫秒级。
*   **响应速度：** 用户操作响应时间小于2秒。
*   **并发用户数：** 支持至少X（待定）个并发用户同时在线使用。

### 数据安全与隐私

*   **数据加密：** 所有传输和存储的能源数据进行加密处理。
*   **传输安全：** 采用HTTPS等安全协议进行数据传输。
*   **用户隐私保护：** 严格遵守相关法律法规，保护用户个人信息和能源数据隐私。

### 可用性与用户体验

*   **界面设计：** 界面简洁直观，具有科技感，符合用户操作直觉。
*   **数据可视化：** 图表清晰易懂，不支持拖放操作。
*   **告警信息：** 设有专门的告警信息查看和处理区域，确保告警及时、清晰。

### 兼容性

*   **微信环境：** 小程序只在微信环境中运行，不存在跨平台兼容性问题。

### 可扩展性

*   **数据接入：** 所有数据（包括水、燃气等）通过统一的模块或API模块获取，便于未来扩展更多能源类型和数据源。
*   **功能扩展：** 架构设计应支持未来引入更复杂的AI能耗预测、优化算法等高级功能。

### 数据准确性要求

*   按照通用要求即可。

## 6. 产品版本与规划 (Product Roadmap & Versioning)

### MVP版本

MVP版本将包含以下最核心的能源管理功能：

*   **核心监控与数据展示：** 实时能耗数据展示、历史能耗数据查询与曲线图。
*   **设备控制：** 远程控制智能设备的开关、模式调节。
*   **自动化规则设置：** 场景模式管理（工厂、学校、楼宇）。
*   **异常能耗告警与通知：** 基本告警触发与通知。
*   **集成与兼容性：** 统一对接模块。
*   **管理与权限：** 多地点/多设备/多区域管理、用户与权限管理。

### 未来迭代

未来迭代可能包含以下更高级的功能或服务：

*   用电负荷分析与趋势预测、碳排放量计算与展示、能耗排名与对比。
*   能耗报告与诊断（更深入的分析和建议）。
*   光伏发电监控、储能系统管理、充电桩管理。
*   更丰富的自动化规则和联动控制。
*   与第三方系统集成（如智能家居平台、物业管理系统）。
*   更高级的AI能耗预测和优化算法。

## 7. 商业模式与盈利 (Business Model & Monetization)

*   **增值服务费：** 提供高级数据分析、定制化节能方案、设备运维服务等。
*   **硬件销售：** 结合智能硬件销售，提供软硬一体化解决方案。
*   **订阅服务：** 针对高级功能或数据存储提供订阅服务。

## 8. 风险与假设 (Risks & Assumptions)

### 风险

*   **数据采集稳定性：** 智能设备和通信网络的稳定性可能影响数据采集的准确性和实时性。
*   **设备兼容性挑战：** 不同品牌、型号的智能设备兼容性可能带来集成难度。
*   **用户节能意识不足：** 用户可能对节能的重视程度不够，影响功能使用率。
*   **政策法规变化：** 能源管理相关政策法规的变化可能影响产品方向。

### 假设

*   用户愿意分享能源数据以获得更好的管理和服务。
*   智能设备市场普及率持续提高，为小程序提供充足的设备基础。
*   通信网络（Wi-Fi、LoRaWAN等）能够满足数据传输需求。

## 9. 技术初步考量 (Initial Technical Considerations)

*   **数据采集方式：** 智能电表直连、API集成、传感器、网关上报等多种方式，通过统一模块处理。
*   **云平台：** 考虑使用主流云服务商（如阿里云IoT、腾讯云IoT）提供的IoT平台和大数据分析服务。
*   **数据存储与分析：** 采用大数据技术进行能耗数据存储、处理和分析，支持AI算法。
*   **后台管理系统：** 需要开发独立的后台管理系统，用于设备管理、用户管理、数据报表、告警配置、系统配置等。

## 10. API数据规范与接口设计 (API Data Specifications & Interface Design)

### 10.1 API架构设计

#### 统一响应格式
所有API接口采用统一的响应格式：
```json
{
  "success": true,
  "data": {},
  "message": "操作成功",
  "code": 200,
  "timestamp": 1640995200000
}
```

#### 环境配置
*   **开发环境：** `https://dev-api.energy.example.com`
*   **测试环境：** `https://test-api.energy.example.com`
*   **生产环境：** `https://api.energy.example.com`

### 10.2 核心数据结构

#### 设备数据结构
```json
{
  "id": "device_001",
  "name": "中央空调-1号机",
  "type": "air_conditioner",
  "location": "办公楼A座",
  "status": "online",
  "isOnline": true,
  "hasAlert": false,
  "specifications": {
    "brand": "格力",
    "model": "GMV-120WL/A",
    "power": "12kW",
    "capacity": "120m²"
  },
  "currentParams": {
    "power": 8.5,
    "temperature": 24,
    "mode": "cooling",
    "fanSpeed": "auto"
  }
}
```

#### 能耗数据结构
```json
{
  "deviceId": "device_001",
  "energyType": "electricity",
  "value": 125.5,
  "unit": "kWh",
  "timestamp": 1640995200000,
  "period": "hour",
  "carbonEmission": 62.75
}
```

#### 告警数据结构
```json
{
  "id": "alert_001",
  "deviceId": "device_001",
  "deviceName": "中央空调-1号机",
  "type": "high_energy_consumption",
  "level": "warning",
  "status": "unread",
  "title": "设备能耗异常",
  "description": "设备能耗超出正常范围30%",
  "timestamp": 1640995200000,
  "location": "办公楼A座"
}
```

### 10.3 页面接口映射

#### 首页 (P01)
*   `GET /api/home/overview` - 获取首页概览数据
*   `GET /api/monitor/realtime` - 获取实时监控数据
*   `GET /api/alerts/summary` - 获取告警概览

#### 设备管理 (P03-P04)
*   `GET /api/devices` - 获取设备列表
*   `GET /api/devices/{id}` - 获取设备详情
*   `POST /api/devices/{id}/control` - 控制设备
*   `POST /api/devices` - 添加设备

#### 设备分组管理 (P14)
*   `GET /api/device-groups` - 获取设备分组列表
*   `POST /api/device-groups` - 创建设备分组
*   `PUT /api/device-groups/{id}` - 更新设备分组信息
*   `DELETE /api/device-groups/{id}` - 删除设备分组
*   `POST /api/device-groups/{id}/devices` - 添加设备到分组
*   `DELETE /api/device-groups/{id}/devices/{deviceId}` - 从分组中移除设备
*   `POST /api/device-groups/{id}/batch-control` - 分组批量设备控制

#### 数据分析 (P05-P06)
*   `GET /api/energy/history` - 获取历史能耗数据
*   `POST /api/reports/generate` - 生成能耗报告
*   `GET /api/saving/plans` - 获取节能方案

#### 告警管理 (P09)
*   `GET /api/alerts` - 获取告警列表
*   `PUT /api/alerts/{id}` - 处理告警

#### 自动化规则 (P10)
*   `GET /api/automation/rules` - 获取自动化规则
*   `POST /api/automation/rules` - 创建自动化规则
*   `PUT /api/automation/rules/{id}` - 更新自动化规则

#### 场景模式 (P13)
*   `GET /api/scenes` - 获取场景模式列表
*   `POST /api/scenes/{id}/activate` - 切换场景模式

### 10.4 模拟数据支持

#### 开发阶段数据来源
*   **模拟数据文件：** `/api-mock.js` - 提供完整的模拟数据
*   **API工具：** `/utils/api.js` - 统一的API调用工具
*   **使用文档：** `/api-usage.md` - 详细的接口使用说明

#### 数据切换机制
```javascript
// 环境配置切换
const API = require('./utils/api.js');

// 开发环境自动使用模拟数据
API.config.setEnvironment('development');

// 生产环境使用真实API
API.config.setEnvironment('production');
```

### 10.5 接口扩展规范

#### 新增接口规范
1. **命名规范：** 遵循RESTful API设计原则
2. **版本控制：** 使用URL版本控制 `/api/v1/`
3. **参数验证：** 所有输入参数必须进行验证
4. **错误处理：** 统一的错误码和错误信息
5. **文档更新：** 新增接口必须更新API文档

#### 数据结构扩展
1. **向后兼容：** 新增字段不影响现有功能
2. **类型安全：** 明确定义数据类型和格式
3. **默认值：** 为可选字段提供合理默认值
4. **验证规则：** 定义数据验证和约束规则

#### 模拟数据扩展
1. **数据完整性：** 模拟数据应覆盖所有业务场景
2. **数据关联性：** 保持数据间的逻辑关联
3. **动态生成：** 支持动态生成时间相关数据
4. **边界测试：** 包含异常和边界情况的测试数据

### 10.6 性能与安全要求

#### 性能要求
*   **响应时间：** 核心接口响应时间 < 2秒
*   **并发处理：** 支持至少100个并发请求
*   **数据缓存：** 实时数据缓存时间 < 30秒

#### 安全要求
*   **身份认证：** JWT Token认证机制
*   **权限控制：** 基于角色的访问控制(RBAC)
*   **数据加密：** HTTPS传输，敏感数据加密存储
*   **接口限流：** 防止API滥用和攻击

## 11. 数据指标与分析 (Metrics & Analytics)

*   **用户日均能耗降低百分比：** 衡量节能效果。
*   **设备在线时长：** 衡量设备连接稳定性。
*   **自动化场景执行成功率：** 衡量自动化功能的有效性。
*   **告警处理及时性：** 衡量异常响应效率。
*   **用户使用时长与功能点击率：** 衡量用户活跃度和功能受欢迎程度。
*   **光伏发电量、储能充放电量、充电桩充电量：** 衡量新能源利用效率。