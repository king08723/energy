<!--pages/device-detail/device-detail.wxml-->
<view class="energy-container">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="energy-bg-decoration">
    <view class="energy-bg-circle" style="width: 180rpx; height: 180rpx; top: 15%; right: -40rpx; animation-delay: 0s; opacity: 0.5;"></view>
    <view class="energy-bg-circle" style="width: 120rpx; height: 120rpx; top: 70%; left: -20rpx; animation-delay: 3s; opacity: 0.4;"></view>
    <view class="energy-bg-circle" style="width: 90rpx; height: 90rpx; top: 45%; right: 15%; animation-delay: 6s; opacity: 0.3;"></view>
  </view>
  
  <!-- è®¾å¤‡åŸºæœ¬ä¿¡æ¯ -->
  <view class="energy-glass-card energy-p-32">
    <view class="energy-flex energy-flex-between energy-mb-24">
      <view class="energy-flex">
        <view class="device-icon-large {{deviceInfo.type}}">
          <text class="energy-icon-text">{{deviceInfo.icon}}</text>
        </view>
        <view class="device-basic-info">
          <text class="energy-title-large energy-mb-8">{{deviceInfo.name}}</text>
          <text class="energy-text-tertiary energy-text-small">{{deviceInfo.type}} Â· {{deviceInfo.location}}</text>
          <view class="energy-flex energy-mt-8">
            <view class="energy-status-dot {{deviceInfo.status}}">
              <text class="energy-text-small">{{deviceInfo.statusText}}</text>
            </view>
            <text class="energy-text-tertiary energy-text-small energy-ml-16">æ›´æ–°äº {{deviceInfo.lastUpdate}}</text>
          </view>
        </view>
      </view>
      <view class="energy-icon" bindtap="onDeviceMenu">
        <text class="energy-icon-text">â‹¯</text>
      </view>
    </view>

    <!-- å‘Šè­¦ä¿¡æ¯ -->
    <view class="alert-banner" wx:if="{{deviceInfo.alerts && deviceInfo.alerts.length > 0}}">
      <view class="energy-flex">
        <text class="energy-icon-text energy-text-warning energy-mr-12">âš ï¸</text>
        <view class="energy-flex-1">
          <text class="energy-text-warning energy-text-medium energy-font-medium">è®¾å¤‡å‘Šè­¦</text>
          <text class="energy-text-warning energy-text-small energy-mt-4">{{deviceInfo.alerts[0].message}}</text>
        </view>
        <view class="energy-btn energy-btn-outline energy-btn-small" bindtap="onViewAlerts">
          <text>æŸ¥çœ‹</text>
        </view>
      </view>
    </view>
  </view>
  
  <!-- è®¾å¤‡æ§åˆ¶ -->
  <view class="energy-glass-card energy-p-24" wx:if="{{deviceInfo.status === 'online'}}">
    <text class="energy-title-medium energy-mb-16">è®¾å¤‡æ§åˆ¶</text>
    
    <!-- å¼€å…³æ§åˆ¶ -->
    <view class="control-section energy-mb-24">
      <view class="energy-flex energy-flex-between energy-mb-16">
        <text class="energy-text-primary energy-text-medium">è®¾å¤‡å¼€å…³</text>
        <switch class="energy-switch" checked="{{deviceInfo.isOn}}" bindchange="onSwitchChange" />
      </view>
      
      <!-- åŠŸç‡è°ƒèŠ‚ -->
      <view class="energy-flex energy-flex-between energy-mb-16" wx:if="{{deviceInfo.supportPowerControl}}">
        <text class="energy-text-primary energy-text-medium">åŠŸç‡è°ƒèŠ‚</text>
        <text class="energy-text-secondary energy-text-small">{{deviceInfo.powerLevel}}%</text>
      </view>
      <slider class="energy-slider" wx:if="{{deviceInfo.supportPowerControl}}"
              value="{{deviceInfo.powerLevel}}"
              min="0" max="100" step="10"
              bindchange="onPowerChange" />
    </view>

    <!-- å¿«æ·æ§åˆ¶æŒ‰é’® -->
    <view class="energy-grid-3">
      <view class="control-btn" bindtap="onQuickControl" data-action="restart">
        <text class="energy-icon-text energy-mb-8">ğŸ”„</text>
        <text class="energy-text-small">é‡å¯</text>
      </view>
      <view class="control-btn" bindtap="onQuickControl" data-action="reset">
        <text class="energy-icon-text energy-mb-8">ğŸ”§</text>
        <text class="energy-text-small">é‡ç½®</text>
      </view>
      <view class="control-btn" bindtap="onQuickControl" data-action="optimize">
        <text class="energy-icon-text energy-mb-8">âš¡</text>
        <text class="energy-text-small">ä¼˜åŒ–</text>
      </view>
    </view>
  </view>
  
  <!-- å®æ—¶æ•°æ® -->
  <view class="energy-glass-card energy-p-24">
    <view class="energy-flex energy-flex-between energy-mb-16">
      <text class="energy-title-medium">å®æ—¶æ•°æ®</text>
      <view class="energy-btn energy-btn-outline energy-btn-small" bindtap="onRefreshData">
        <text>åˆ·æ–°</text>
      </view>
    </view>
    
    <view class="energy-grid-2">
      <view class="energy-data-card" wx:for="{{deviceInfo.realTimeData}}" wx:key="key">
        <text class="energy-text-tertiary energy-text-small">{{item.label}}</text>
        <text class="energy-title-medium energy-text-primary">{{item.value}}</text>
        <text class="energy-text-tertiary energy-text-small">{{item.unit}}</text>
      </view>
    </view>
  </view>
  
  <!-- å†å²æ•°æ®å›¾è¡¨ -->
  <view class="energy-glass-card energy-p-24">
    <view class="energy-flex energy-flex-between energy-mb-16">
      <text class="energy-title-medium">å†å²æ•°æ®</text>
      <view class="energy-flex">
        <view class="time-filter {{timeFilter === '1h' ? 'active' : ''}}" data-filter="1h" bindtap="onTimeFilterChange">
          <text>1å°æ—¶</text>
        </view>
        <view class="time-filter {{timeFilter === '24h' ? 'active' : ''}}" data-filter="24h" bindtap="onTimeFilterChange">
          <text>24å°æ—¶</text>
        </view>
        <view class="time-filter {{timeFilter === '7d' ? 'active' : ''}}" data-filter="7d" bindtap="onTimeFilterChange">
          <text>7å¤©</text>
        </view>
      </view>
    </view>
    
    <!-- ç®€åŒ–çš„å›¾è¡¨å±•ç¤º -->
    <view class="chart-container">
      <view class="chart-placeholder">
        <text class="energy-icon-text energy-text-large energy-mb-16">ğŸ“Š</text>
        <text class="energy-text-tertiary energy-text-small">{{timeFilter}}æ•°æ®å›¾è¡¨</text>
        <text class="energy-text-tertiary energy-text-small energy-mt-8">ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†åˆ†æ</text>
      </view>
    </view>
  </view>
  
  <!-- è‡ªåŠ¨åŒ–è§„åˆ™ -->
  <view class="energy-glass-card energy-p-24">
    <view class="energy-flex energy-flex-between energy-mb-16">
      <text class="energy-title-medium">è‡ªåŠ¨åŒ–è§„åˆ™</text>
      <view class="energy-btn energy-btn-outline energy-btn-small" bindtap="onAddRule">
        <text>æ·»åŠ </text>
      </view>
    </view>
    
    <view class="automation-rules" wx:if="{{deviceInfo.automationRules && deviceInfo.automationRules.length > 0}}">
      <view class="rule-item" wx:for="{{deviceInfo.automationRules}}" wx:key="id">
        <view class="energy-flex energy-flex-between">
          <view class="energy-flex-1">
            <text class="energy-text-primary energy-text-medium energy-font-medium">{{item.name}}</text>
            <text class="energy-text-tertiary energy-text-small energy-mt-4">{{item.description}}</text>
          </view>
          <switch class="energy-switch" checked="{{item.enabled}}" 
                  data-rule="{{item.id}}" bindchange="onRuleToggle" />
        </view>
      </view>
    </view>
    
    <view class="energy-empty-state" wx:else>
      <text class="energy-icon-text energy-text-large energy-mb-16">ğŸ¤–</text>
      <text class="energy-text-tertiary energy-text-small">æš‚æ— è‡ªåŠ¨åŒ–è§„åˆ™</text>
    </view>
  </view>
  
  <!-- è®¾å¤‡ä¿¡æ¯ -->
  <view class="energy-glass-card energy-p-24">
    <text class="energy-title-medium energy-mb-16">è®¾å¤‡ä¿¡æ¯</text>
    
    <view class="device-info-list">
      <view class="info-item" wx:for="{{deviceInfo.specifications}}" wx:key="key">
        <text class="energy-text-tertiary energy-text-small">{{item.label}}</text>
        <text class="energy-text-primary energy-text-medium">{{item.value}}</text>
      </view>
    </view>
  </view>
  
  <!-- æ“ä½œæŒ‰é’® -->
  <view class="energy-glass-card energy-p-24">
    <view class="energy-grid-2">
      <view class="energy-btn energy-btn-outline" bindtap="onEditDevice">
        <text class="energy-icon-text energy-mr-8">âœï¸</text>
        <text>ç¼–è¾‘è®¾å¤‡</text>
      </view>
      <view class="energy-btn energy-btn-outline" bindtap="onDeviceSettings">
        <text class="energy-icon-text energy-mr-8">âš™ï¸</text>
        <text>è®¾å¤‡è®¾ç½®</text>
      </view>
    </view>
  </view>
</view>