<!--pages/data/data.wxml-->
<view class="energy-container">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="energy-bg-decoration">
    <view class="energy-bg-circle" style="width: 200rpx; height: 200rpx; top: 10%; left: -50rpx; animation-delay: 0s;"></view>
    <view class="energy-bg-circle" style="width: 150rpx; height: 150rpx; top: 30%; right: -30rpx; animation-delay: 2s;"></view>
    <view class="energy-bg-circle" style="width: 100rpx; height: 100rpx; top: 60%; left: 20%; animation-delay: 4s;"></view>
    <view class="energy-bg-circle" style="width: 120rpx; height: 120rpx; bottom: 20%; right: 10%; animation-delay: 6s;"></view>
  </view>

  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="energy-glass-card energy-p-32 energy-mb-16">
    <view class="energy-title-medium energy-mb-16">æ•°æ®åˆ†æ</view>
    <view class="energy-text-tertiary">æŸ¥çœ‹å†å²èƒ½è€—æ•°æ®ï¼Œç”Ÿæˆåˆ†ææŠ¥å‘Š</view>
  </view>

  <!-- é¡µé¢å†…å¿«é€Ÿå¯¼èˆªæ  -->
  <view class="page-nav-container energy-mb-24">
    <view class="page-nav-scroll">
      <view class="page-nav-item {{activeSection === 'overview' ? 'active' : ''}}" bindtap="scrollToSection" data-section="overview">
        <view class="nav-icon overview"></view>
        <view class="nav-text">èƒ½è€—æ¦‚è§ˆ</view>
      </view>
      <view class="page-nav-item {{activeSection === 'trend' ? 'active' : ''}}" bindtap="scrollToSection" data-section="trend">
        <view class="nav-icon trend"></view>
        <view class="nav-text">è¶‹åŠ¿åˆ†æ</view>
      </view>
      <view class="page-nav-item {{activeSection === 'compare' ? 'active' : ''}}" bindtap="scrollToSection" data-section="compare">
        <view class="nav-icon compare"></view>
        <view class="nav-text">å¯¹æ¯”åˆ†æ</view>
      </view>
      <view class="page-nav-item {{activeSection === 'report' ? 'active' : ''}}" bindtap="scrollToSection" data-section="report">
        <view class="nav-icon report"></view>
        <view class="nav-text">æŠ¥å‘Šç”Ÿæˆ</view>
      </view>
    </view>
  </view>

  <!-- æ—¶é—´èŒƒå›´é€‰æ‹©å™¨ -->
  <view class="energy-glass-card energy-p-24 energy-mb-24">
    <view class="energy-title-small energy-mb-16">æ—¶é—´èŒƒå›´</view>
    <view class="time-selector-container">
      <view class="time-tabs">
        <view 
          class="time-tab {{activeTimeRange === 'day' ? 'active' : ''}}"
          bindtap="onTimeRangeChange"
          data-range="day"
          hover-class="time-tab-hover"
        >
          æ—¥
        </view>
        <view 
          class="time-tab {{activeTimeRange === 'week' ? 'active' : ''}}"
          bindtap="onTimeRangeChange"
          data-range="week"
          hover-class="time-tab-hover"
        >
          å‘¨
        </view>
        <view 
          class="time-tab {{activeTimeRange === 'month' ? 'active' : ''}}"
          bindtap="onTimeRangeChange"
          data-range="month"
          hover-class="time-tab-hover"
        >
          æœˆ
        </view>
        <view 
          class="time-tab {{activeTimeRange === 'year' ? 'active' : ''}}"
          bindtap="onTimeRangeChange"
          data-range="year"
          hover-class="time-tab-hover"
        >
          å¹´
        </view>
        <view 
          class="time-tab {{activeTimeRange === 'custom' ? 'active' : ''}}"
          bindtap="onTimeRangeChange"
          data-range="custom"
          hover-class="time-tab-hover"
        >
          è‡ªå®šä¹‰
        </view>
      </view>
      
      <!-- è‡ªå®šä¹‰æ—¶é—´é€‰æ‹© -->
      <view class="custom-time-picker" wx:if="{{activeTimeRange === 'custom'}}">
        <view class="picker-row">
          <view class="picker-label">å¼€å§‹æ—¶é—´</view>
          <picker 
            mode="date" 
            value="{{startDate}}" 
            bindchange="onStartDateChange"
            class="date-picker"
          >
            <view class="picker-value">{{startDate}}</view>
          </picker>
        </view>
        <view class="picker-row">
          <view class="picker-label">ç»“æŸæ—¶é—´</view>
          <picker 
            mode="date" 
            value="{{endDate}}" 
            bindchange="onEndDateChange"
            class="date-picker"
          >
            <view class="picker-value">{{endDate}}</view>
          </picker>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œåŒºåŸŸ - æå‡è‡³é¡µé¢ä¸Šéƒ¨ -->
  <view class="energy-glass-card energy-p-24 energy-mb-24">
    <view class="energy-title-small energy-mb-16">å¿«æ·æ“ä½œ</view>
    <view class="quick-actions-grid">
      <view class="quick-action-card" bindtap="onNavigateToSaving" hover-class="quick-action-hover">
        <view class="action-icon saving">
          <text class="icon">ğŸ’¡</text>
        </view>
        <view class="action-title energy-text-primary">èŠ‚èƒ½å»ºè®®</view>
      </view>
      
      <view class="quick-action-card" bindtap="onNavigateToAlerts" hover-class="quick-action-hover">
        <view class="action-icon alerts">
          <text class="icon">âš ï¸</text>
        </view>
        <view class="action-title energy-text-primary">å‘Šè­¦è¯¦æƒ…</view>
      </view>
      
      <view class="quick-action-card" bindtap="onNavigateToDevices" hover-class="quick-action-hover">
        <view class="action-icon devices">
          <text class="icon">ğŸ”Œ</text>
        </view>
        <view class="action-title energy-text-primary">è®¾å¤‡ç®¡ç†</view>
      </view>

      <view class="quick-action-card" bindtap="onGenerateReport" hover-class="quick-action-hover">
        <view class="action-icon report">
          <text class="icon">ğŸ“Š</text>
        </view>
        <view class="action-title energy-text-primary">ç”ŸæˆæŠ¥å‘Š</view>
      </view>
    </view>
  </view>

  <!-- èƒ½è€—æ¦‚è§ˆä¸è¶‹åŠ¿å›¾è¡¨ç„¦ç‚¹åŒºåŸŸ -->
  <view class="energy-glass-card energy-p-24 energy-mb-24" id="overview-section">
    <view class="section-header">
      <view class="energy-title-small">èƒ½è€—æ¦‚è§ˆ</view>
      <view class="section-actions">
        <view class="refresh-btn" bindtap="refreshData" hover-class="btn-hover">
          <text class="refresh-icon">ğŸ”„</text>
        </view>
      </view>
    </view>

    <!-- èƒ½è€—æ¦‚è§ˆç½‘æ ¼ - æ”¹ä¸ºæ¨ªå‘å¸ƒå±€ -->
    <scroll-view scroll-x="true" class="overview-scroll-container">
      <view class="energy-overview-row">
        <view class="overview-item" bindtap="showEnergyDetail" data-type="electricity" hover-class="overview-item-hover">
          <view class="overview-icon electricity">
            <text class="icon">âš¡</text>
          </view>
          <view class="overview-content">
            <view class="overview-label energy-text-tertiary">ç”µåŠ›</view>
            <view class="overview-value energy-text-primary">{{energyOverview.electricity}} kWh</view>
            <view class="overview-change {{energyOverview.electricityChange >= 0 ? 'positive' : 'negative'}}">
              {{energyOverview.electricityChange >= 0 ? '+' : ''}}{{energyOverview.electricityChange}}%
            </view>
            <!-- è¿·ä½ è¶‹åŠ¿å›¾ -->
            <view class="mini-trend-container">
              <view class="mini-trend {{energyOverview.electricityChange >= 0 ? 'positive' : 'negative'}}"></view>
            </view>
          </view>
        </view>
        
        <view class="overview-item" bindtap="showEnergyDetail" data-type="water" hover-class="overview-item-hover">
          <view class="overview-icon water">
            <text class="icon">ğŸ’§</text>
          </view>
          <view class="overview-content">
            <view class="overview-label energy-text-tertiary">æ°´</view>
            <view class="overview-value energy-text-primary">{{energyOverview.water}} å¨</view>
            <view class="overview-change {{energyOverview.waterChange >= 0 ? 'positive' : 'negative'}}">
              {{energyOverview.waterChange >= 0 ? '+' : ''}}{{energyOverview.waterChange}}%
            </view>
            <!-- è¿·ä½ è¶‹åŠ¿å›¾ -->
            <view class="mini-trend-container">
              <view class="mini-trend {{energyOverview.waterChange >= 0 ? 'positive' : 'negative'}}"></view>
            </view>
          </view>
        </view>
        
        <view class="overview-item" bindtap="showEnergyDetail" data-type="gas" hover-class="overview-item-hover">
          <view class="overview-icon gas">
            <text class="icon">ğŸ”¥</text>
          </view>
          <view class="overview-content">
            <view class="overview-label energy-text-tertiary">ç‡ƒæ°”</view>
            <view class="overview-value energy-text-primary">{{energyOverview.gas}} mÂ³</view>
            <view class="overview-change {{energyOverview.gasChange >= 0 ? 'positive' : 'negative'}}">
              {{energyOverview.gasChange >= 0 ? '+' : ''}}{{energyOverview.gasChange}}%
            </view>
            <!-- è¿·ä½ è¶‹åŠ¿å›¾ -->
            <view class="mini-trend-container">
              <view class="mini-trend {{energyOverview.gasChange >= 0 ? 'positive' : 'negative'}}"></view>
            </view>
          </view>
        </view>
        
        <view class="overview-item" bindtap="showEnergyDetail" data-type="carbon" hover-class="overview-item-hover">
          <view class="overview-icon carbon">
            <text class="icon">ğŸŒ±</text>
          </view>
          <view class="overview-content">
            <view class="overview-label energy-text-tertiary">ç¢³æ’æ”¾</view>
            <view class="overview-value energy-text-primary">{{energyOverview.carbon}} kg</view>
            <view class="overview-change {{energyOverview.carbonChange >= 0 ? 'positive' : 'negative'}}">
              {{energyOverview.carbonChange >= 0 ? '+' : ''}}{{energyOverview.carbonChange}}%
            </view>
            <!-- è¿·ä½ è¶‹åŠ¿å›¾ -->
            <view class="mini-trend-container">
              <view class="mini-trend {{energyOverview.carbonChange >= 0 ? 'positive' : 'negative'}}"></view>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- èƒ½è€—è¶‹åŠ¿å›¾è¡¨ -->
    <view class="trend-section" id="trend-section">
      <view class="chart-header">
        <view class="energy-title-small">èƒ½è€—è¶‹åŠ¿</view>
        <view class="chart-controls">
          <!-- æ•°æ®ç±»å‹é€‰æ‹© -->
          <view class="data-type-selector">
            <view 
              class="data-type-btn {{activeDataType === 'all' ? 'active' : ''}}"
              bindtap="onDataTypeChange"
              data-type="all"
              hover-class="btn-hover"
            >
              å…¨éƒ¨
            </view>
            <view 
              class="data-type-btn {{activeDataType === 'electricity' ? 'active' : ''}}"
              bindtap="onDataTypeChange"
              data-type="electricity"
              hover-class="btn-hover"
            >
              ç”µåŠ›
            </view>
            <view 
              class="data-type-btn {{activeDataType === 'water' ? 'active' : ''}}"
              bindtap="onDataTypeChange"
              data-type="water"
              hover-class="btn-hover"
            >
              æ°´
            </view>
            <view 
              class="data-type-btn {{activeDataType === 'gas' ? 'active' : ''}}"
              bindtap="onDataTypeChange"
              data-type="gas"
              hover-class="btn-hover"
            >
              ç‡ƒæ°”
            </view>
          </view>
          
          <!-- å›¾è¡¨ç±»å‹é€‰æ‹©å™¨ -->
          <view class="chart-type-selector">
            <view 
              class="chart-type-btn {{chartType === 'line' ? 'active' : ''}}"
              bindtap="onChartTypeChange"
              data-type="line"
              hover-class="btn-hover"
            >
              ğŸ“ˆ
            </view>
            <view 
              class="chart-type-btn {{chartType === 'bar' ? 'active' : ''}}"
              bindtap="onChartTypeChange"
              data-type="bar"
              hover-class="btn-hover"
            >
              ğŸ“Š
            </view>
          </view>
        </view>
      </view>
      
      <!-- å›¾è¡¨å®¹å™¨ -->
      <view class="chart-container">
        <canvas 
          canvas-id="energyChart" 
          class="energy-chart"
          bindtouchstart="onChartTouchStart"
          bindtouchmove="onChartTouchMove"
          bindtouchend="onChartTouchEnd"
        ></canvas>
        
        <!-- å›¾è¡¨äº¤äº’æç¤º -->
        <view class="chart-tooltip" wx:if="{{showTooltip}}" style="left: {{tooltipX}}px; top: {{tooltipY}}px;">
          <view class="tooltip-date">{{tooltipDate}}</view>
          <view class="tooltip-value">{{tooltipValue}}</view>
        </view>
        
        <!-- å›¾è¡¨åŠ è½½çŠ¶æ€ -->
        <view class="chart-loading" wx:if="{{chartLoading}}">
          <view class="loading-spinner"></view>
          <view class="energy-text-tertiary">å›¾è¡¨åŠ è½½ä¸­...</view>
        </view>
        
        <!-- å›¾è¡¨æ— æ•°æ®çŠ¶æ€ -->
        <view class="chart-empty" wx:if="{{!chartLoading && chartData.length === 0}}">
          <view class="empty-icon">ğŸ“Š</view>
          <view class="energy-text-tertiary">æš‚æ— æ•°æ®</view>
        </view>
      </view>
      
      <!-- å›¾ä¾‹ -->
      <view class="chart-legend" wx:if="{{!chartLoading && chartData.length > 0}}">
        <view class="legend-item" bindtap="toggleDataSeries" data-series="electricity">
          <view class="legend-color electricity {{hiddenSeries.electricity ? 'disabled' : ''}}"></view>
          <view class="legend-label energy-text-tertiary">ç”µåŠ›</view>
        </view>
        <view class="legend-item" bindtap="toggleDataSeries" data-series="water">
          <view class="legend-color water {{hiddenSeries.water ? 'disabled' : ''}}"></view>
          <view class="legend-label energy-text-tertiary">æ°´</view>
        </view>
        <view class="legend-item" bindtap="toggleDataSeries" data-series="gas">
          <view class="legend-color gas {{hiddenSeries.gas ? 'disabled' : ''}}"></view>
          <view class="legend-label energy-text-tertiary">ç‡ƒæ°”</view>
        </view>
      </view>

      <!-- å›¾è¡¨ç¼©æ”¾æ§åˆ¶ -->
      <view class="chart-zoom-controls">
        <view class="zoom-btn" bindtap="zoomChart" data-zoom="in" hover-class="btn-hover">+</view>
        <view class="zoom-btn" bindtap="zoomChart" data-zoom="reset" hover-class="btn-hover">é‡ç½®</view>
        <view class="zoom-btn" bindtap="zoomChart" data-zoom="out" hover-class="btn-hover">-</view>
      </view>
    </view>
  </view>

  <!-- èƒ½è€—å¯¹æ¯”åˆ†æ -->
  <view class="energy-glass-card energy-p-24 energy-mb-24" id="compare-section">
    <view class="section-header">
      <view class="energy-title-small">å¯¹æ¯”åˆ†æ</view>
      <view class="section-actions">
        <view class="help-btn" bindtap="showCompareHelp" hover-class="btn-hover">
          <text class="help-icon">?</text>
        </view>
      </view>
    </view>
    
    <!-- å¯¹æ¯”ç±»å‹é€‰æ‹© -->
    <view class="compare-type-selector energy-mb-16">
      <view 
        class="compare-type-btn {{compareType === 'period' ? 'active' : ''}}"
        bindtap="onCompareTypeChange"
        data-type="period"
        hover-class="btn-hover"
      >
        åŒæœŸå¯¹æ¯”
      </view>
      <view 
        class="compare-type-btn {{compareType === 'chain' ? 'active' : ''}}"
        bindtap="onCompareTypeChange"
        data-type="chain"
        hover-class="btn-hover"
      >
        ç¯æ¯”å¯¹æ¯”
      </view>
    </view>
    
    <!-- å¯¹æ¯”ç»“æœ -->
    <view class="compare-results">
      <view class="compare-item" wx:for="{{compareData}}" wx:key="type" bindtap="showCompareDetail" data-type="{{item.type}}" hover-class="compare-item-hover">
        <view class="compare-header">
          <view class="compare-title energy-text-primary">{{item.name}}</view>
          <view class="compare-change {{item.change >= 0 ? 'positive' : 'negative'}}">
            {{item.change >= 0 ? '+' : ''}}{{item.change}}%
          </view>
        </view>
        <view class="compare-values">
          <view class="compare-value">
            <view class="value-label energy-text-tertiary">å½“å‰</view>
            <view class="value-number energy-text-primary">{{item.current}}</view>
          </view>
          <view class="compare-value">
            <view class="value-label energy-text-tertiary">{{compareType === 'period' ? 'åŒæœŸ' : 'ä¸ŠæœŸ'}}</view>
            <view class="value-number energy-text-secondary">{{item.previous}}</view>
          </view>
        </view>
        <view class="compare-bar">
          <view class="bar-bg">
            <view 
              class="bar-fill {{item.change >= 0 ? 'positive' : 'negative'}}"
              style="width: {{Math.min(Math.abs(item.change), 100)}}%"
            ></view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æŠ¥å‘Šç”Ÿæˆ - ç®€åŒ–ä¸ºæŠ˜å é¢æ¿ -->
  <view class="energy-glass-card energy-p-24" id="report-section">
    <view class="collapsible-header" bindtap="toggleReportPanel">
      <view class="energy-title-small">æŠ¥å‘Šç”Ÿæˆ</view>
      <view class="collapse-icon {{showReportPanel ? 'expanded' : ''}}">â–¼</view>
    </view>
    
    <view class="collapsible-content" wx:if="{{showReportPanel}}">
      <!-- æŠ¥å‘Šç±»å‹é€‰æ‹© -->
      <view class="report-type-selector energy-mb-16">
        <view 
          class="report-type-item {{reportType === 'summary' ? 'active' : ''}}"
          bindtap="onReportTypeChange"
          data-type="summary"
          hover-class="report-type-hover"
        >
          <view class="report-icon">ğŸ“‹</view>
          <view class="report-name">èƒ½è€—æ±‡æ€»</view>
        </view>
        <view 
          class="report-type-item {{reportType === 'detailed' ? 'active' : ''}}"
          bindtap="onReportTypeChange"
          data-type="detailed"
          hover-class="report-type-hover"
        >
          <view class="report-icon">ğŸ“Š</view>
          <view class="report-name">è¯¦ç»†åˆ†æ</view>
        </view>
        <view 
          class="report-type-item {{reportType === 'carbon' ? 'active' : ''}}"
          bindtap="onReportTypeChange"
          data-type="carbon"
          hover-class="report-type-hover"
        >
          <view class="report-icon">ğŸŒ±</view>
          <view class="report-name">ç¢³æ’æ”¾</view>
        </view>
      </view>
      
      <!-- æŠ¥å‘Šæ ¼å¼é€‰æ‹© -->
      <view class="report-format-selector energy-mb-24">
        <view class="format-label energy-text-tertiary energy-mb-8">å¯¼å‡ºæ ¼å¼</view>
        <view class="format-options">
          <view 
            class="format-option {{reportFormat === 'pdf' ? 'active' : ''}}"
            bindtap="onReportFormatChange"
            data-format="pdf"
            hover-class="format-option-hover"
          >
            PDF
          </view>
          <view 
            class="format-option {{reportFormat === 'excel' ? 'active' : ''}}"
            bindtap="onReportFormatChange"
            data-format="excel"
            hover-class="format-option-hover"
          >
            Excel
          </view>
        </view>
      </view>
      
      <!-- ç”ŸæˆæŒ‰é’® -->
      <view class="report-actions">
        <button 
          class="energy-btn energy-btn-primary"
          bindtap="onGenerateReport"
          loading="{{reportGenerating}}"
          disabled="{{reportGenerating}}"
        >
          {{reportGenerating ? 'ç”Ÿæˆä¸­...' : 'ç”ŸæˆæŠ¥å‘Š'}}
        </button>
        <button 
          class="energy-btn energy-btn-secondary"
          bindtap="onPreviewReport"
          disabled="{{reportGenerating}}"
        >
          é¢„è§ˆ
        </button>
      </view>
    </view>
  </view>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="floating-action-button" bindtap="scrollToTop" wx:if="{{showBackToTop}}">
    <text class="fab-icon">â†‘</text>
  </view>
</view>