<!-- pages/profile/profile.wxml -->
<!-- æ™ºæ…§èƒ½æºç®¡ç† - æˆ‘çš„é¡µé¢ -->
<!-- æä¾›ç”¨æˆ·ä¸ªäººä¿¡æ¯ç®¡ç†ã€è´¦å·è®¾ç½®ã€æ¶ˆæ¯ä¸­å¿ƒåŠå…¶ä»–è¾…åŠ©åŠŸèƒ½ -->

<view class="energy-container">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="energy-bg-decoration">
    <view class="energy-bg-circle" style="width: 200rpx; height: 200rpx; top: 10%; left: -50rpx; animation-delay: 0s;"></view>
    <view class="energy-bg-circle" style="width: 150rpx; height: 150rpx; top: 30%; right: -30rpx; animation-delay: 2s;"></view>
    <view class="energy-bg-circle" style="width: 100rpx; height: 100rpx; top: 60%; left: 20rpx; animation-delay: 4s;"></view>
    <view class="energy-bg-circle" style="width: 120rpx; height: 120rpx; bottom: 20%; right: 50rpx; animation-delay: 6s;"></view>
  </view>

  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="energy-glass-card energy-p-32 energy-mb-32">
    <view class="profile-header">
      <!-- ç”¨æˆ·å¤´åƒå’ŒåŸºæœ¬ä¿¡æ¯ -->
      <view class="profile-user-info">
        <view class="profile-avatar-container">
          <image 
            class="profile-avatar" 
            src="{{userInfo.avatar || '/images/default-avatar.svg'}}" 
            mode="aspectFill"
          ></image>
          <view class="profile-avatar-badge">
            <text class="profile-role-text">{{userInfo.role === 'admin' ? 'ç®¡ç†å‘˜' : 'ç”¨æˆ·'}}</text>
          </view>
        </view>
        
        <view class="profile-user-details">
          <view class="profile-name-section">
            <text class="energy-title-medium">{{userInfo.nickname || 'ç”¨æˆ·'}}</text>
            <view class="profile-edit-btn" bindtap="onEditProfile">
              <text class="profile-edit-icon">âœï¸</text>
            </view>
          </view>
          
          <view class="profile-info-row">
            <text class="energy-text-secondary">{{userInfo.phone || 'æœªç»‘å®šæ‰‹æœº'}}</text>
          </view>
          
          <view class="profile-info-row" wx:if="{{userInfo.company}}">
            <text class="energy-text-tertiary">{{userInfo.company}}</text>
            <text class="energy-text-tertiary" wx:if="{{userInfo.department}}"> Â· {{userInfo.department}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡æ•°æ®å¡ç‰‡ -->
  <view class="energy-glass-card energy-p-24 energy-mb-32">
    <view class="profile-stats-header">
      <text class="energy-title-small">æˆ‘çš„æ•°æ®</text>
      <text class="energy-text-tertiary">å®æ—¶ç»Ÿè®¡</text>
    </view>
    
    <view class="profile-stats-grid">
      <view class="profile-stat-item">
        <view class="profile-stat-icon energy-icon-power">
          <text>ğŸ”Œ</text>
        </view>
        <view class="profile-stat-content">
          <text class="profile-stat-number">{{statistics.deviceCount}}</text>
          <text class="profile-stat-label">è®¾å¤‡æ•°é‡</text>
        </view>
      </view>
      
      <view class="profile-stat-item">
        <view class="profile-stat-icon energy-icon-water">
          <text>ğŸ””</text>
        </view>
        <view class="profile-stat-content">
          <text class="profile-stat-number">{{statistics.alertCount}}</text>
          <text class="profile-stat-label">å¾…å¤„ç†å‘Šè­¦</text>
        </view>
      </view>
      
      <view class="profile-stat-item">
        <view class="profile-stat-icon energy-icon-carbon">
          <text>ğŸ’¡</text>
        </view>
        <view class="profile-stat-content">
          <text class="profile-stat-number">{{statistics.energySaving}}%</text>
          <text class="profile-stat-label">èŠ‚èƒ½æ•ˆæœ</text>
        </view>
      </view>
      
      <view class="profile-stat-item">
        <view class="profile-stat-icon energy-icon-gas">
          <text>ğŸŒ±</text>
        </view>
        <view class="profile-stat-content">
          <text class="profile-stat-number">{{statistics.carbonReduction}}</text>
          <text class="profile-stat-label">å‡ç¢³é‡(kg)</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="energy-glass-card energy-p-24 energy-mb-32">
    <view class="profile-section-header">
      <text class="energy-title-small">åŠŸèƒ½ä¸­å¿ƒ</text>
    </view>
    
    <view class="profile-menu-list">
      <view 
        class="profile-menu-item energy-transition" 
        wx:for="{{menuItems}}" 
        wx:key="id"
        data-item="{{item}}"
        bindtap="onMenuItemTap"
      >
        <view class="profile-menu-icon">
          <text>{{item.icon}}</text>
        </view>
        
        <view class="profile-menu-content">
          <view class="profile-menu-title">
            <text class="energy-text-primary">{{item.title}}</text>
            <view class="profile-menu-badge" wx:if="{{item.count > 0}}">
              <text class="profile-badge-text">{{item.count}}</text>
            </view>
          </view>
          <text class="energy-text-tertiary">{{item.subtitle}}</text>
        </view>
        
        <view class="profile-menu-arrow">
          <text class="energy-text-secondary">â€º</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è®¾ç½®èœå• -->
  <view class="energy-glass-card energy-p-24 energy-mb-32">
    <view class="profile-section-header">
      <text class="energy-title-small">è®¾ç½®</text>
    </view>
    
    <view class="profile-menu-list">
      <view 
        class="profile-menu-item energy-transition" 
        wx:for="{{settingItems}}" 
        wx:key="id"
        data-item="{{item}}"
        bindtap="onSettingItemTap"
      >
        <view class="profile-menu-icon">
          <text>{{item.icon}}</text>
        </view>
        
        <view class="profile-menu-content">
          <text class="energy-text-primary">{{item.title}}</text>
          <text class="energy-text-tertiary">{{item.subtitle}}</text>
        </view>
        
        <view class="profile-menu-arrow">
          <text class="energy-text-secondary">â€º</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é€€å‡ºç™»å½•æŒ‰é’® -->
  <view class="profile-logout-container">
    <view class="profile-logout-btn energy-transition" bindtap="onLogout">
      <text class="profile-logout-text">é€€å‡ºç™»å½•</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="profile-loading" wx:if="{{loading}}">
    <view class="energy-glass-card energy-p-32 energy-flex-center">
      <text class="energy-text-secondary">åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>