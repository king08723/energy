<!--pages/device-detail/device-detail.wxml-->
<view class="energy-container">
  <!-- èƒŒæ™¯è£…é¥° - å¢å¼ºè§†è§‰æ•ˆæœ -->
  <view class="energy-bg-decoration">
    <view class="energy-bg-circle" style="width: 220rpx; height: 220rpx; top: 5%; right: -60rpx; animation-delay: 0s; opacity: 0.6;"></view>
    <view class="energy-bg-circle" style="width: 180rpx; height: 180rpx; top: 40%; left: -40rpx; animation-delay: 2s; opacity: 0.5;"></view>
    <view class="energy-bg-circle" style="width: 150rpx; height: 150rpx; top: 70%; right: 10%; animation-delay: 4s; opacity: 0.4;"></view>
    <view class="energy-bg-circle" style="width: 100rpx; height: 100rpx; top: 20%; left: 15%; animation-delay: 6s; opacity: 0.3;"></view>
  </view>
  
  <!-- è®¾å¤‡åŸºæœ¬ä¿¡æ¯å¡ç‰‡ - é‡æ–°è®¾è®¡ï¼Œæ›´åŠ çªå‡º -->
  <view class="energy-glass-card device-header-card energy-p-32">
    <!-- è®¾å¤‡çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <view class="device-status-indicator {{deviceInfo.status}}">
      <text>{{deviceInfo.statusText}}</text>
    </view>
    
    <view class="energy-flex energy-flex-between energy-mb-24">
      <view class="energy-flex">
        <view class="device-icon-large {{deviceInfo.type}} energy-pulsing">
          <text class="energy-icon-text">{{deviceInfo.icon}}</text>
        </view>
        <view class="device-basic-info">
          <text class="energy-title-large energy-mb-8">{{deviceInfo.name}}</text>
          <view class="device-meta">
            <text class="energy-text-secondary energy-text-small">{{deviceInfo.type}} Â· {{deviceInfo.location}}</text>
            <text class="energy-text-tertiary energy-text-small energy-ml-16">æ›´æ–°äº {{deviceInfo.lastUpdate}}</text>
          </view>
        </view>
      </view>
      <!-- å¿«æ·æ“ä½œæŒ‰é’® -->
      <view class="device-quick-actions">
        <view class="quick-action-btn" bindtap="onRefreshData">
          <text class="energy-icon-text">ğŸ”„</text>
        </view>
        <view class="quick-action-btn" bindtap="onDeviceMenu">
          <text class="energy-icon-text">â‹¯</text>
        </view>
      </view>
    </view>

    <!-- å‘Šè­¦ä¿¡æ¯ - è§†è§‰ä¼˜åŒ– -->
    <view class="alert-banner" wx:if="{{deviceInfo.alerts && deviceInfo.alerts.length > 0}}">
      <view class="energy-flex">
        <text class="energy-icon-text energy-text-warning energy-mr-12 alert-icon">âš ï¸</text>
        <view class="energy-flex-1">
          <text class="energy-text-warning energy-text-medium energy-font-medium">è®¾å¤‡å‘Šè­¦</text>
          <text class="energy-text-warning energy-text-small energy-mt-4">{{deviceInfo.alerts[0].message}}</text>
        </view>
        <view class="energy-btn energy-btn-outline energy-btn-small alert-view-btn" bindtap="onViewAlerts">
          <text>æŸ¥çœ‹</text>
        </view>
      </view>
    </view>
    
    <!-- è®¾å¤‡æ ¸å¿ƒæ•°æ® - æ–°å¢ï¼Œçªå‡ºé‡è¦ä¿¡æ¯ -->
    <view class="device-core-metrics" wx:if="{{deviceInfo.status === 'online'}}">
      <view class="core-metric" wx:for="{{deviceInfo.realTimeData}}" wx:key="key" wx:if="{{index < 2}}">
        <text class="metric-value energy-text-glow">{{item.value}}<text class="metric-unit">{{item.unit}}</text></text>
        <text class="metric-label energy-text-tertiary">{{item.label}}</text>
      </view>
    </view>
  </view>
  
  <!-- è®¾å¤‡æ§åˆ¶é¢æ¿ - é‡æ–°è®¾è®¡ï¼Œæ›´ç›´è§‚ -->
  <view class="energy-glass-card energy-p-24" wx:if="{{deviceInfo.status === 'online'}}">
    <view class="card-header energy-flex energy-flex-between energy-mb-16">
      <text class="energy-title-medium">è®¾å¤‡æ§åˆ¶</text>
      <view class="device-power-status {{deviceInfo.isOn ? 'on' : 'off'}}">
        <text>{{deviceInfo.isOn ? 'è¿è¡Œä¸­' : 'å·²å…³é—­'}}</text>
      </view>
    </view>
    
    <!-- å¼€å…³æ§åˆ¶ - è§†è§‰ä¼˜åŒ– -->
    <view class="control-section energy-mb-24">
      <view class="energy-flex energy-flex-between energy-mb-16">
        <text class="energy-text-primary energy-text-medium">è®¾å¤‡å¼€å…³</text>
        <switch class="energy-switch custom-switch" color="#00ffff" checked="{{deviceInfo.isOn}}" bindchange="onSwitchChange" />
      </view>
      
      <!-- åŠŸç‡è°ƒèŠ‚ - è§†è§‰ä¼˜åŒ– -->
      <view class="energy-flex energy-flex-between energy-mb-16" wx:if="{{deviceInfo.supportPowerControl}}">
        <text class="energy-text-primary energy-text-medium">åŠŸç‡è°ƒèŠ‚</text>
        <text class="energy-text-secondary energy-text-small power-level-text">{{deviceInfo.powerLevel}}%</text>
      </view>
      <view class="slider-container" wx:if="{{deviceInfo.supportPowerControl}}">
        <slider class="energy-slider custom-slider" 
                value="{{deviceInfo.powerLevel}}"
                min="0" max="100" step="10"
                activeColor="rgba(0, 255, 255, 0.8)"
                backgroundColor="rgba(255, 255, 255, 0.1)"
                block-size="28"
                block-color="#ffffff"
                bindchange="onPowerChange" />
        <view class="slider-markers">
          <view class="slider-marker" wx:for="{{[0, 25, 50, 75, 100]}}" wx:key="*this">
            <text class="marker-text">{{item}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å¿«æ·æ§åˆ¶æŒ‰é’® - è§†è§‰ä¼˜åŒ– -->
    <view class="energy-grid-3">
      <view class="control-btn" bindtap="onQuickControl" data-action="restart">
        <text class="energy-icon-text energy-mb-8">ğŸ”„</text>
        <text class="energy-text-small">é‡å¯</text>
      </view>
      <view class="control-btn" bindtap="onQuickControl" data-action="reset">
        <text class="energy-icon-text energy-mb-8">ğŸ”§</text>
        <text class="energy-text-small">é‡ç½®</text>
      </view>
      <view class="control-btn" bindtap="onQuickControl" data-action="optimize">
        <text class="energy-icon-text energy-mb-8">âš¡</text>
        <text class="energy-text-small">ä¼˜åŒ–</text>
      </view>
    </view>
  </view>
  
  <!-- å®æ—¶æ•°æ® - è§†è§‰ä¼˜åŒ– -->
  <view class="energy-glass-card energy-p-24">
    <view class="card-header energy-flex energy-flex-between energy-mb-16">
      <text class="energy-title-medium">å®æ—¶æ•°æ®</text>
      <view class="last-update-time">
        <text class="energy-text-tertiary energy-text-small">{{deviceInfo.lastUpdate}}</text>
      </view>
    </view>
    
    <view class="realtime-data-grid">
      <view class="realtime-data-card" wx:for="{{deviceInfo.realTimeData}}" wx:key="key">
        <view class="data-icon-container">
          <text class="data-icon">{{item.key === 'power' ? 'âš¡' : item.key === 'temperature' ? 'ğŸŒ¡ï¸' : item.key === 'humidity' ? 'ğŸ’§' : 'ğŸ“Š'}}</text>
        </view>
        <view class="data-content">
          <text class="energy-text-tertiary energy-text-small">{{item.label}}</text>
          <view class="data-value-container">
            <text class="energy-title-medium energy-text-primary data-value">{{item.value}}</text>
            <text class="energy-text-tertiary energy-text-small data-unit">{{item.unit}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- èƒ½è€—åˆ†æå›¾è¡¨ - è§†è§‰ä¼˜åŒ– -->
  <view class="energy-glass-card energy-p-24">
    <view class="card-header energy-flex energy-flex-between energy-mb-16">
      <text class="energy-title-medium">èƒ½è€—åˆ†æ</text>
      <view class="time-filter-container">
        <view class="time-filter {{timeFilter === '1h' ? 'active' : ''}}" data-filter="1h" bindtap="onTimeFilterChange">
          <text>1å°æ—¶</text>
        </view>
        <view class="time-filter {{timeFilter === '24h' ? 'active' : ''}}" data-filter="24h" bindtap="onTimeFilterChange">
          <text>24å°æ—¶</text>
        </view>
        <view class="time-filter {{timeFilter === '7d' ? 'active' : ''}}" data-filter="7d" bindtap="onTimeFilterChange">
          <text>7å¤©</text>
        </view>
      </view>
    </view>
    
    <!-- èƒ½è€—æ•°æ®æ‘˜è¦ -->
    <view class="energy-summary-container energy-mb-16" wx:if="{{energyData}}">
      <view class="energy-summary-item">
        <text class="energy-text-tertiary energy-text-small">æ€»èƒ½è€—</text>
        <view class="energy-flex energy-flex-align-center">
          <text class="energy-title-medium energy-text-primary">{{energyData.totalEnergy}}</text>
          <text class="energy-text-tertiary energy-text-small energy-ml-4">{{energyData.unit}}</text>
        </view>
      </view>
      <view class="energy-summary-item">
        <text class="energy-text-tertiary energy-text-small">ç¢³æ’æ”¾</text>
        <view class="energy-flex energy-flex-align-center">
          <text class="energy-title-medium energy-text-primary">{{energyData.carbonEmission}}</text>
          <text class="energy-text-tertiary energy-text-small energy-ml-4">kg</text>
        </view>
      </view>
      <view class="energy-summary-item">
        <text class="energy-text-tertiary energy-text-small">èƒ½æ•ˆç­‰çº§</text>
        <view class="energy-flex energy-flex-align-center">
          <text class="energy-title-medium energy-text-primary">{{energyData.efficiencyLevel || 'A'}}</text>
        </view>
      </view>
    </view>
    
    <!-- èƒ½è€—å›¾è¡¨ -->
    <view class="chart-container">
      <block wx:if="{{energyData && energyData.data && energyData.data.length > 0}}">
        <canvas type="2d" id="energyChart" class="energy-chart"></canvas>
      </block>
      <view class="chart-placeholder" wx:else>
        <text class="energy-icon-text energy-text-large energy-mb-16 chart-icon">ğŸ“Š</text>
        <text class="energy-text-secondary energy-text-small">æš‚æ— {{timeFilter}}èƒ½è€—æ•°æ®</text>
        <text class="energy-text-tertiary energy-text-small energy-mt-8">è¯·ç¨åå†è¯•</text>
      </view>
    </view>
    
    <!-- èƒ½è€—åˆ†æè¯´æ˜ -->
    <view class="energy-analysis-tips energy-mt-16" wx:if="{{energyData}}">
      <text class="energy-text-tertiary energy-text-small">{{timeFilter === '1h' ? 'è¿‡å»1å°æ—¶' : timeFilter === '24h' ? 'è¿‡å»24å°æ—¶' : 'è¿‡å»7å¤©'}}å†…ï¼Œè¯¥è®¾å¤‡èƒ½è€—{{energyData.trend === 'up' ? 'ä¸Šå‡' : energyData.trend === 'down' ? 'ä¸‹é™' : 'ç¨³å®š'}}{{energyData.trendValue || ''}}{{energyData.trend !== 'stable' ? '%' : ''}}ã€‚</text>
    </view>
  </view>
  
  <!-- è‡ªåŠ¨åŒ–è§„åˆ™ - è§†è§‰ä¼˜åŒ– -->
  <view class="energy-glass-card energy-p-24">
    <view class="card-header energy-flex energy-flex-between energy-mb-16">
      <text class="energy-title-medium">è‡ªåŠ¨åŒ–è§„åˆ™</text>
      <view class="energy-btn energy-btn-outline energy-btn-small add-rule-btn" bindtap="onAddRule">
        <text class="add-icon">+</text>
        <text>æ·»åŠ </text>
      </view>
    </view>
    
    <view class="automation-rules" wx:if="{{deviceInfo.automationRules && deviceInfo.automationRules.length > 0}}">
      <view class="rule-item" wx:for="{{deviceInfo.automationRules}}" wx:key="id">
        <view class="energy-flex energy-flex-between">
          <view class="rule-icon">
            <text class="energy-icon-text">ğŸ¤–</text>
          </view>
          <view class="energy-flex-1 rule-content">
            <text class="energy-text-primary energy-text-medium energy-font-medium">{{item.name}}</text>
            <text class="energy-text-tertiary energy-text-small energy-mt-4">{{item.description}}</text>
          </view>
          <switch class="energy-switch" color="#00ffff" checked="{{item.enabled}}" 
                  data-rule="{{item.id}}" bindchange="onRuleToggle" />
        </view>
      </view>
    </view>
    
    <view class="energy-empty-state" wx:else>
      <text class="energy-icon-text energy-text-large energy-mb-16">ğŸ¤–</text>
      <text class="energy-text-tertiary energy-text-small">æš‚æ— è‡ªåŠ¨åŒ–è§„åˆ™</text>
      <text class="energy-text-tertiary energy-text-small energy-mt-8">æ·»åŠ è§„åˆ™è®©è®¾å¤‡æ›´æ™ºèƒ½</text>
    </view>
  </view>
  
  <!-- è®¾å¤‡ä¿¡æ¯ - è§†è§‰ä¼˜åŒ– -->
  <view class="energy-glass-card energy-p-24">
    <view class="card-header energy-flex energy-flex-between energy-mb-16">
      <text class="energy-title-medium">è®¾å¤‡ä¿¡æ¯</text>
      <view class="device-info-badge">
        <text class="energy-text-tertiary energy-text-small">{{deviceInfo.specifications[0].value}}</text>
      </view>
    </view>
    
    <view class="device-info-list">
      <view class="info-item" wx:for="{{deviceInfo.specifications}}" wx:key="key">
        <text class="energy-text-tertiary energy-text-small">{{item.label}}</text>
        <text class="energy-text-primary energy-text-medium">{{item.value}}</text>
      </view>
    </view>
  </view>
  
  <!-- æ“ä½œæŒ‰é’® - è§†è§‰ä¼˜åŒ– -->
  <view class="action-buttons-container">
    <view class="energy-btn energy-btn-outline action-btn" bindtap="onEditDevice">
      <text class="energy-icon-text energy-mr-8">âœï¸</text>
      <text>ç¼–è¾‘è®¾å¤‡</text>
    </view>
    <view class="energy-btn energy-btn-outline action-btn" bindtap="onDeviceSettings">
      <text class="energy-icon-text energy-mr-8">âš™ï¸</text>
      <text>è®¾å¤‡è®¾ç½®</text>
    </view>
  </view>
</view>