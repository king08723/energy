<!--pages/group-management/group-management.wxml-->
<!-- è®¾å¤‡åˆ†ç»„ç®¡ç†é¡µé¢ -->

<view class="energy-container">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="energy-bg-decoration">
    <view class="energy-bg-circle" style="top: 10%; left: 80%; width: 120rpx; height: 120rpx;"></view>
    <view class="energy-bg-circle" style="top: 60%; left: 10%; width: 80rpx; height: 80rpx;"></view>
    <view class="energy-bg-circle" style="top: 80%; left: 70%; width: 100rpx; height: 100rpx;"></view>
  </view>

  <!-- é¡µé¢å†…å®¹ -->
  <view class="energy-glass-card energy-p-32">
    <!-- é¡µé¢æ ‡é¢˜å’Œæ·»åŠ æŒ‰é’® -->
    <view class="energy-flex energy-flex-between energy-mb-32">
      <view class="energy-title-large">è®¾å¤‡åˆ†ç»„ç®¡ç†</view>
      <view class="energy-btn energy-btn-primary" bindtap="onShowAddDialog">
        <text class="energy-icon">+</text>
        <text>æ·»åŠ åˆ†ç»„</text>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="energy-loading-container">
      <view class="energy-loading-spinner"></view>
      <text class="energy-text-secondary energy-mt-16">åŠ è½½ä¸­...</text>
    </view>

    <!-- åˆ†ç»„åˆ—è¡¨ -->
    <view wx:else class="group-list">
      <!-- ç©ºçŠ¶æ€ -->
      <view wx:if="{{groupList.length === 0}}" class="energy-empty-state">
        <view class="energy-empty-icon">ğŸ“</view>
        <text class="energy-text-secondary">æš‚æ— è®¾å¤‡åˆ†ç»„</text>
        <text class="energy-text-tertiary energy-mt-8">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»ºç¬¬ä¸€ä¸ªåˆ†ç»„</text>
      </view>

      <!-- åˆ†ç»„å¡ç‰‡åˆ—è¡¨ -->
      <view wx:else>
        <view wx:for="{{groupList}}" wx:key="id" class="group-card energy-glass-card energy-mb-24">
          <!-- åˆ†ç»„å¤´éƒ¨ä¿¡æ¯ -->
          <view class="group-header energy-flex energy-flex-between">
            <view class="group-info energy-flex">
              <view class="group-icon">{{item.icon === 'office' ? 'ğŸ¢' : item.icon === 'factory' ? 'ğŸ­' : item.icon === 'home' ? 'ğŸ ' : item.icon === 'outdoor' ? 'ğŸŒ³' : 'ğŸ“'}}</view>
              <view class="group-details">
                <text class="group-name energy-text-primary">{{item.name}}</text>
                <text class="group-description energy-text-secondary">{{item.description || 'æš‚æ— æè¿°'}}</text>
              </view>
            </view>
            <view class="group-actions energy-flex">
              <view class="action-btn" bindtap="onShowEditDialog" data-group="{{item}}">
                <text class="energy-icon">âœï¸</text>
              </view>
              <view class="action-btn" bindtap="onDeleteGroup" data-group="{{item}}">
                <text class="energy-icon">ğŸ—‘ï¸</text>
              </view>
            </view>
          </view>

          <!-- åˆ†ç»„ç»Ÿè®¡ä¿¡æ¯ -->
          <view class="group-stats energy-flex energy-mt-16">
            <view class="stat-item">
              <text class="stat-value energy-text-primary">{{item.deviceCount || 0}}</text>
              <text class="stat-label energy-text-tertiary">è®¾å¤‡æ•°é‡</text>
            </view>
            <view class="stat-item">
              <text class="stat-value energy-text-primary">{{item.onlineCount || 0}}</text>
              <text class="stat-label energy-text-tertiary">åœ¨çº¿è®¾å¤‡</text>
            </view>
            <view class="stat-item">
              <text class="stat-value energy-text-primary">{{item.alertCount || 0}}</text>
              <text class="stat-label energy-text-tertiary">å‘Šè­¦æ•°é‡</text>
            </view>
          </view>

          <!-- åˆ†ç»„æ“ä½œæŒ‰é’® -->
          <view class="group-operations energy-flex energy-mt-24">
            <view class="operation-btn energy-btn energy-btn-secondary" bindtap="onManageDevices" data-group="{{item}}">
              <text class="energy-icon">âš™ï¸</text>
              <text>ç®¡ç†è®¾å¤‡</text>
            </view>
            <view class="operation-btn energy-btn energy-btn-outline">
              <text class="energy-icon">ğŸ“Š</text>
              <text>æŸ¥çœ‹ç»Ÿè®¡</text>
            </view>
          </view>

          <!-- åˆ›å»ºæ—¶é—´ -->
          <view class="group-meta energy-mt-16">
            <text class="energy-text-tertiary">åˆ›å»ºæ—¶é—´ï¼š{{item.createdAt}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
  <custom-footer></custom-footer>
</view>

<!-- æ·»åŠ åˆ†ç»„å¯¹è¯æ¡† -->
<view wx:if="{{showAddDialog}}" class="dialog-overlay" bindtap="onHideAddDialog">
  <view class="dialog-content energy-glass-card" catchtap="">
    <view class="dialog-header">
      <text class="dialog-title energy-title-medium">æ·»åŠ è®¾å¤‡åˆ†ç»„</text>
      <view class="dialog-close" bindtap="onHideAddDialog">Ã—</view>
    </view>

    <view class="dialog-body">
      <!-- åˆ†ç»„åç§° -->
      <view class="form-group energy-mb-24">
        <text class="form-label energy-text-primary">åˆ†ç»„åç§°</text>
        <input class="form-input" placeholder="è¯·è¾“å…¥åˆ†ç»„åç§°" value="{{formData.name}}" bindinput="onFormInput" data-field="name" />
      </view>

      <!-- åˆ†ç»„æè¿° -->
      <view class="form-group energy-mb-24">
        <text class="form-label energy-text-primary">åˆ†ç»„æè¿°</text>
        <textarea class="form-textarea" placeholder="è¯·è¾“å…¥åˆ†ç»„æè¿°ï¼ˆå¯é€‰ï¼‰" value="{{formData.description}}" bindinput="onFormInput" data-field="description"></textarea>
      </view>

      <!-- å›¾æ ‡é€‰æ‹© -->
      <view class="form-group energy-mb-24">
        <text class="form-label energy-text-primary">é€‰æ‹©å›¾æ ‡</text>
        <view class="icon-selector energy-flex">
          <view wx:for="{{iconOptions}}" wx:key="value" class="icon-option {{formData.icon === item.value ? 'selected' : ''}}" bindtap="onIconSelect" data-icon="{{item.value}}">
            <text class="icon-emoji">{{item.icon}}</text>
            <text class="icon-label">{{item.label}}</text>
          </view>
        </view>
      </view>
    </view>

    <view class="dialog-footer energy-flex">
      <view class="dialog-btn energy-btn energy-btn-secondary" bindtap="onHideAddDialog">å–æ¶ˆ</view>
      <view class="dialog-btn energy-btn energy-btn-primary" bindtap="onCreateGroup">åˆ›å»º</view>
    </view>
  </view>
</view>

<!-- ç¼–è¾‘åˆ†ç»„å¯¹è¯æ¡† -->
<view wx:if="{{showEditDialog}}" class="dialog-overlay" bindtap="onHideEditDialog">
  <view class="dialog-content energy-glass-card" catchtap="">
    <view class="dialog-header">
      <text class="dialog-title energy-title-medium">ç¼–è¾‘è®¾å¤‡åˆ†ç»„</text>
      <view class="dialog-close" bindtap="onHideEditDialog">Ã—</view>
    </view>

    <view class="dialog-body">
      <!-- åˆ†ç»„åç§° -->
      <view class="form-group energy-mb-24">
        <text class="form-label energy-text-primary">åˆ†ç»„åç§°</text>
        <input class="form-input" placeholder="è¯·è¾“å…¥åˆ†ç»„åç§°" value="{{formData.name}}" bindinput="onFormInput" data-field="name" />
      </view>

      <!-- åˆ†ç»„æè¿° -->
      <view class="form-group energy-mb-24">
        <text class="form-label energy-text-primary">åˆ†ç»„æè¿°</text>
        <textarea class="form-textarea" placeholder="è¯·è¾“å…¥åˆ†ç»„æè¿°ï¼ˆå¯é€‰ï¼‰" value="{{formData.description}}" bindinput="onFormInput" data-field="description"></textarea>
      </view>

      <!-- å›¾æ ‡é€‰æ‹© -->
      <view class="form-group energy-mb-24">
        <text class="form-label energy-text-primary">é€‰æ‹©å›¾æ ‡</text>
        <view class="icon-selector energy-flex">
          <view wx:for="{{iconOptions}}" wx:key="value" class="icon-option {{formData.icon === item.value ? 'selected' : ''}}" bindtap="onIconSelect" data-icon="{{item.value}}">
            <text class="icon-emoji">{{item.icon}}</text>
            <text class="icon-label">{{item.label}}</text>
          </view>
        </view>
      </view>
    </view>

    <view class="dialog-footer energy-flex">
      <view class="dialog-btn energy-btn energy-btn-secondary" bindtap="onHideEditDialog">å–æ¶ˆ</view>
      <view class="dialog-btn energy-btn energy-btn-primary" bindtap="onUpdateGroup">ä¿å­˜</view>
    </view>
  </view>
</view>